import{a as u,j as t}from"./index-DNHKrThd.js";import{f as J,r as l}from"./react-vendor-BpgKpUzx.js";import{z as m,I as K,g as Z,a as ee,h as te,C as re,s as oe,u as I,a3 as ie,a4 as se,O as ne,Q as le}from"./ui-vendor-yLLZ9URH.js";import"./pdf-vendor-BOaogWDS.js";const ue=()=>{const _=J(),[w,E]=l.useState([]),[L,M]=l.useState([]),[T,k]=l.useState([]),[O,z]=l.useState(!0),[g,q]=l.useState(""),[b,F]=l.useState(""),[c,D]=l.useState("list"),[d,P]=l.useState(new Date),[Y,f]=l.useState(!1),[y,R]=l.useState(null),[o,a]=l.useState({client_id:"",vehicle_id:"",mechanic_id:"",service_type:"",title:"",description:"",start_time:"",end_time:"",status:"scheduled",notes:""});l.useEffect(()=>{h(),$()},[b,d,c]),l.useEffect(()=>{const e=()=>{h()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]),l.useEffect(()=>{_.pathname==="/agendamentos"&&h()},[_.pathname]);const h=async()=>{try{z(!0);const e={};if(b&&(e.status=b),c==="calendar"){const i=new Date(d.getFullYear(),d.getMonth(),1),n=new Date(d.getFullYear(),d.getMonth()+1,0,23,59,59);e.start_date=i.toISOString(),e.end_date=n.toISOString()}let s=(await u.get("/appointments",{params:e})).data;g&&(s=s.filter(i=>{var n,S,x;return i.title.toLowerCase().includes(g.toLowerCase())||((n=i.client_name)==null?void 0:n.toLowerCase().includes(g.toLowerCase()))||((S=i.brand)==null?void 0:S.toLowerCase().includes(g.toLowerCase()))||((x=i.model)==null?void 0:x.toLowerCase().includes(g.toLowerCase()))})),E(s)}catch(e){m.error("Erro ao carregar agendamentos"),console.error(e)}finally{z(!1)}},$=async()=>{try{const e=await u.get("/clients");M(e.data)}catch(e){console.error("Erro ao carregar clientes:",e)}},B=async e=>{try{const r=e?{client_id:e}:{},s=await u.get("/vehicles",{params:r});k(s.data)}catch(r){console.error("Erro ao carregar veículos:",r)}},H=async e=>{var r,s;e.preventDefault();try{const i={...o,client_id:parseInt(o.client_id),vehicle_id:parseInt(o.vehicle_id),mechanic_id:o.mechanic_id?parseInt(o.mechanic_id):null,start_time:new Date(o.start_time).toISOString(),end_time:new Date(o.end_time).toISOString()};y?(await u.put(`/appointments/${y.id}`,i),m.success("Agendamento atualizado com sucesso!")):(await u.post("/appointments",i),m.success("Agendamento criado com sucesso!")),f(!1),j(),h()}catch(i){m.error(((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao salvar agendamento")}},W=e=>{var r;R(e),a({client_id:e.client_id.toString(),vehicle_id:e.vehicle_id.toString(),mechanic_id:((r=e.mechanic_id)==null?void 0:r.toString())||"",service_type:e.service_type||"",title:e.title,description:e.description||"",start_time:new Date(e.start_time).toISOString().slice(0,16),end_time:new Date(e.end_time).toISOString().slice(0,16),status:e.status,notes:e.notes||""}),B(e.client_id),f(!0)},Q=async e=>{if(confirm("Tem certeza que deseja excluir este agendamento?"))try{await u.delete(`/appointments/${e}`),m.success("Agendamento excluído com sucesso!"),h()}catch{m.error("Erro ao excluir agendamento")}},v=async(e,r)=>{var s,i;try{await u.post(`/appointments/${e}/quick-action`,{action:r}),m.success("Ação executada com sucesso!"),h()}catch(n){m.error(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.error)||"Erro ao executar ação")}},j=()=>{a({client_id:"",vehicle_id:"",mechanic_id:"",service_type:"",title:"",description:"",start_time:"",end_time:"",status:"scheduled",notes:""}),R(null),k([])},V=e=>new Date(e).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),N=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),C=e=>({scheduled:"#64748b",confirmed:"#3b82f6",in_progress:"#f59e0b",completed:"#10b981",cancelled:"#ef4444"})[e]||"#64748b",G=e=>({scheduled:"Agendado",confirmed:"Confirmado",in_progress:"Em Andamento",completed:"Concluído",cancelled:"Cancelado"})[e]||e,U=()=>{const e=d.getFullYear(),r=d.getMonth(),s=new Date(e,r,1),n=new Date(e,r+1,0).getDate(),S=s.getDay(),x=[];for(let p=0;p<S;p++)x.push(null);for(let p=1;p<=n;p++)x.push(new Date(e,r,p));return x},X=e=>{if(!e)return[];const r=e.toLocaleDateString("pt-BR");return w.filter(s=>new Date(s.start_time).toLocaleDateString("pt-BR")===r)},A=e=>{const r=new Date(d);e==="prev"?r.setMonth(r.getMonth()-1):r.setMonth(r.getMonth()+1),P(r)};return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"1.875rem",fontWeight:"bold",color:"#1e293b",marginBottom:"0.5rem"},children:"Agenda"}),t.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Gerencie os agendamentos da oficina"})]}),t.jsxs("button",{onClick:()=>{j(),f(!0)},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[t.jsx(K,{size:20}),"Novo Agendamento"]})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap",marginBottom:"1rem"},children:[t.jsxs("div",{style:{position:"relative",flex:1,minWidth:"250px",maxWidth:"400px"},children:[t.jsx(Z,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#64748b"}}),t.jsx("input",{type:"text",placeholder:"Buscar por título, cliente ou veículo...",value:g,onChange:e=>q(e.target.value),style:{width:"100%",padding:"0.75rem 1rem 0.75rem 2.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",outline:"none"}})]}),t.jsxs("select",{value:b,onChange:e=>F(e.target.value),style:{padding:"0.75rem 1rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",cursor:"pointer"},children:[t.jsx("option",{value:"",children:"Todos os status"}),t.jsx("option",{value:"scheduled",children:"Agendado"}),t.jsx("option",{value:"confirmed",children:"Confirmado"}),t.jsx("option",{value:"in_progress",children:"Em Andamento"}),t.jsx("option",{value:"completed",children:"Concluído"}),t.jsx("option",{value:"cancelled",children:"Cancelado"})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsx("button",{onClick:()=>D("list"),style:{padding:"0.75rem 1rem",backgroundColor:c==="list"?"#f97316":"#f1f5f9",color:c==="list"?"white":"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Lista"}),t.jsx("button",{onClick:()=>D("calendar"),style:{padding:"0.75rem 1rem",backgroundColor:c==="calendar"?"#f97316":"#f1f5f9",color:c==="calendar"?"white":"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Calendário"})]})]})]}),c==="list"&&t.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",overflow:"hidden"},children:O?t.jsx("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Carregando..."}):w.length===0?t.jsx("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Nenhum agendamento encontrado"}):t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:w.map(e=>t.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"background-color 0.2s"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="white"},children:[t.jsx("div",{style:{flex:1},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"8px",backgroundColor:"#3b82f6",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(ee,{size:24})}),t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.25rem"},children:[t.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600",color:"#1e293b"},children:e.title}),t.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:C(e.status)+"20",color:C(e.status)},children:G(e.status)})]}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",fontSize:"0.875rem",color:"#64748b"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(te,{size:14}),e.client_name]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(re,{size:14}),e.brand," ",e.model," ",e.plate&&`- ${e.plate}`]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(oe,{size:14}),V(e.start_time)]})]}),e.description&&t.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:e.description})]})]})}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.status==="scheduled"&&t.jsx("button",{onClick:()=>v(e.id,"confirm"),style:{padding:"0.5rem",backgroundColor:"#eff6ff",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Confirmar",children:t.jsx(I,{size:16,color:"#3b82f6"})}),e.status==="confirmed"&&t.jsx("button",{onClick:()=>v(e.id,"start"),style:{padding:"0.5rem",backgroundColor:"#fef3c7",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Iniciar",children:t.jsx(ie,{size:16,color:"#f59e0b"})}),e.status==="in_progress"&&t.jsx("button",{onClick:()=>v(e.id,"complete"),style:{padding:"0.5rem",backgroundColor:"#f0fdf4",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Concluir",children:t.jsx(I,{size:16,color:"#10b981"})}),e.status!=="cancelled"&&e.status!=="completed"&&t.jsx("button",{onClick:()=>v(e.id,"cancel"),style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Cancelar",children:t.jsx(se,{size:16,color:"#ef4444"})}),t.jsx("button",{onClick:()=>W(e),style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Editar",children:t.jsx(ne,{size:16,color:"#64748b"})}),t.jsx("button",{onClick:()=>Q(e.id),style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Excluir",children:t.jsx(le,{size:16,color:"#ef4444"})})]})]},e.id))})}),c==="calendar"&&t.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",padding:"1.5rem"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[t.jsx("button",{onClick:()=>A("prev"),style:{padding:"0.5rem 1rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer"},children:"← Anterior"}),t.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600"},children:d.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),t.jsx("button",{onClick:()=>A("next"),style:{padding:"0.5rem 1rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Próximo →"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"0.5rem"},children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(e=>t.jsx("div",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600",color:"#64748b",fontSize:"0.875rem"},children:e},e)),U().map((e,r)=>{const s=X(e),i=e&&e.toDateString()===new Date().toDateString();return t.jsx("div",{style:{minHeight:"100px",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",backgroundColor:i?"#eff6ff":"white"},children:e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{fontWeight:i?"bold":"600",marginBottom:"0.5rem",color:i?"#3b82f6":"#1e293b"},children:e.getDate()}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[s.slice(0,3).map(n=>t.jsxs("div",{onClick:()=>W(n),style:{padding:"0.25rem 0.5rem",backgroundColor:C(n.status)+"20",color:C(n.status),borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",fontWeight:"600",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n.title,children:[N(n.start_time)," - ",n.title]},n.id)),s.length>3&&t.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b",textAlign:"center"},children:["+",s.length-3," mais"]})]})]})},r)})]})]}),Y&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>{f(!1),j()},children:t.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"600px",maxHeight:"90vh",overflowY:"auto"},onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{style:{marginBottom:"1.5rem",fontSize:"1.5rem",fontWeight:"bold"},children:y?"Editar Agendamento":"Novo Agendamento"}),t.jsxs("form",{onSubmit:H,children:[t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Cliente *"}),t.jsxs("select",{value:o.client_id,onChange:e=>{a({...o,client_id:e.target.value,vehicle_id:""}),e.target.value&&B(parseInt(e.target.value))},required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[t.jsx("option",{value:"",children:"Selecione um cliente"}),L.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Veículo *"}),t.jsxs("select",{value:o.vehicle_id,onChange:e=>a({...o,vehicle_id:e.target.value}),required:!0,disabled:!o.client_id,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",opacity:o.client_id?1:.6},children:[t.jsx("option",{value:"",children:"Selecione um veículo"}),T.map(e=>t.jsxs("option",{value:e.id,children:[e.brand," ",e.model," ",e.plate&&`- ${e.plate}`]},e.id))]})]}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Título *"}),t.jsx("input",{type:"text",value:o.title,onChange:e=>a({...o,title:e.target.value}),required:!0,placeholder:"Ex: Revisão completa, Troca de óleo...",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Data/Hora Início *"}),t.jsx("input",{type:"datetime-local",value:o.start_time,onChange:e=>a({...o,start_time:e.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Data/Hora Término *"}),t.jsx("input",{type:"datetime-local",value:o.end_time,onChange:e=>a({...o,end_time:e.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]})]}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Descrição"}),t.jsx("textarea",{value:o.description,onChange:e=>a({...o,description:e.target.value}),rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",resize:"vertical"}})]}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Tipo de Serviço"}),t.jsx("input",{type:"text",value:o.service_type,onChange:e=>a({...o,service_type:e.target.value}),placeholder:"Ex: Revisão, Manutenção, Reparo...",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Observações"}),t.jsx("textarea",{value:o.notes,onChange:e=>a({...o,notes:e.target.value}),rows:2,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",resize:"vertical"}})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[t.jsx("button",{type:"button",onClick:()=>{f(!1),j()},style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),t.jsx("button",{type:"submit",style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:y?"Atualizar":"Criar"})]})]})]})})]})};export{ue as default};
