import{u as q,a as g,j as e}from"./index-DNHKrThd.js";import{u as N,r as i}from"./react-vendor-BpgKpUzx.js";import{s as v,a as C}from"./ToastEnhancer-LsyHRCIg.js";import{S as R}from"./SkeletonLoader-DMsGFzU7.js";import{P as $}from"./Pagination-MtMwbbp0.js";import{C as F}from"./ConfirmDialog-DmvZqo8B.js";import{S as K,aa as Y,I as G,g as H,K as Q,u as X,ab as J,O as V,Q as Z}from"./ui-vendor-yLLZ9URH.js";import"./pdf-vendor-BOaogWDS.js";const _={admin:"Administrador",mechanic:"Mecânico",financial:"Financeiro",attendant:"Atendente"},le=()=>{var B;const{user:l}=q(),E=N(),[S,I]=i.useState([]),[P,w]=i.useState(!0),[d,U]=i.useState(""),[f,k]=i.useState(1),[h]=i.useState(10),[D,c]=i.useState(!1),[o,z]=i.useState(null),[m,x]=i.useState({isOpen:!1,user:null}),[t,a]=i.useState({name:"",email:"",password:"",profile:"attendant",active:!0}),u=(l==null?void 0:l.profile)==="admin";i.useEffect(()=>{u&&y()},[d,u]);const y=async()=>{var r,s;try{w(!0);const n=await g.get("/users");I(n.data)}catch(n){v(((s=(r=n.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao carregar usuários"),console.error(n)}finally{w(!1)}},b=i.useMemo(()=>S.filter(r=>{const s=d.toLowerCase();return r.name.toLowerCase().includes(s)||r.email.toLowerCase().includes(s)}),[S,d]),W=i.useMemo(()=>{const r=(f-1)*h,s=r+h;return b.slice(r,s)},[b,f,h]),A=Math.ceil(b.length/h);i.useEffect(()=>{k(1)},[d]);const T=async r=>{var s,n;r.preventDefault();try{if(o){const p={name:t.name};u&&(p.profile=t.profile,p.active=t.active),await g.put(`/users/${o.id}`,p),C(`Usuário "${t.name}" atualizado com sucesso!`)}else await g.post("/users",t),C(`Usuário "${t.name}" criado com sucesso!`);c(!1),j(),y()}catch(p){v(((n=(s=p.response)==null?void 0:s.data)==null?void 0:n.error)||"Erro ao salvar usuário")}},M=r=>{z(r),a({name:r.name,email:r.email,password:"",profile:r.profile,active:r.active}),c(!0)},L=r=>{x({isOpen:!0,user:r})},O=async()=>{var r,s;if(m.user)try{await g.delete(`/users/${m.user.id}`),C(`Usuário "${m.user.name}" desativado com sucesso!`),x({isOpen:!1,user:null}),y()}catch(n){v(((s=(r=n.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao desativar usuário"),x({isOpen:!1,user:null})}},j=()=>{a({name:"",email:"",password:"",profile:"attendant",active:!0}),z(null)};return u?P?e.jsxs("div",{children:[e.jsx(R,{type:"text",lines:2,width:"40%",height:"32px"}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsx(R,{type:"card"})})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"1.875rem",fontWeight:"bold",color:"#1e293b",marginBottom:"0.5rem"},children:"Usuários"}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Gerencie os usuários do sistema"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsxs("button",{onClick:()=>E("/permissoes"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#6366f1",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[e.jsx(Y,{size:18}),"Permissões"]}),e.jsxs("button",{onClick:()=>{j(),c(!0)},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[e.jsx(G,{size:20}),"Novo Usuário"]})]})]}),e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{position:"relative",maxWidth:"400px"},children:[e.jsx(H,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#64748b"}}),e.jsx("input",{type:"text",placeholder:"Buscar por nome ou email...",value:d,onChange:r=>U(r.target.value),style:{width:"100%",padding:"0.75rem 0.75rem 0.75rem 2.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]})}),e.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",overflow:"hidden"},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#1e293b",fontSize:"0.875rem"},children:"Nome"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#1e293b",fontSize:"0.875rem"},children:"Email"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#1e293b",fontSize:"0.875rem"},children:"Perfil"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#1e293b",fontSize:"0.875rem"},children:"Status"}),e.jsx("th",{style:{padding:"1rem",textAlign:"right",fontWeight:"600",color:"#1e293b",fontSize:"0.875rem"},children:"Ações"})]})}),e.jsx("tbody",{children:W.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Nenhum usuário encontrado"})}):W.map(r=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"#f97316",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.9rem"},children:r.name.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2)}),e.jsx("span",{style:{fontWeight:"500",color:"#1e293b"},children:r.name})]})}),e.jsx("td",{style:{padding:"1rem",color:"#64748b"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Q,{size:16,color:"#64748b"}),r.email]})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:r.profile==="admin"?"#fee2e2":"#dbeafe",color:r.profile==="admin"?"#991b1b":"#1e40af"},children:_[r.profile]})}),e.jsx("td",{style:{padding:"1rem"},children:r.active?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#10b981"},children:[e.jsx(X,{size:16}),"Ativo"]}):e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#ef4444"},children:[e.jsx(J,{size:16}),"Inativo"]})}),e.jsx("td",{style:{padding:"1rem",textAlign:"right"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>M(r),style:{padding:"0.5rem",backgroundColor:"transparent",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",color:"#64748b"},title:"Editar",children:e.jsx(V,{size:18})}),r.id!==(l==null?void 0:l.id)&&e.jsx("button",{onClick:()=>L(r),style:{padding:"0.5rem",backgroundColor:"transparent",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",color:"#ef4444"},title:"Desativar",children:e.jsx(Z,{size:18})})]})})]},r.id))})]})})}),A>1&&e.jsx("div",{style:{marginTop:"1.5rem"},children:e.jsx($,{currentPage:f,totalPages:A,onPageChange:k})}),D&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:()=>c(!1),children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",maxWidth:"500px",width:"100%",maxHeight:"90vh",overflowY:"auto"},onClick:r=>r.stopPropagation(),children:[e.jsx("h2",{style:{marginBottom:"1.5rem",fontSize:"1.5rem",fontWeight:"bold",color:"#1e293b"},children:o?"Editar Usuário":"Novo Usuário"}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:"#1e293b"},children:"Nome *"}),e.jsx("input",{type:"text",value:t.name,onChange:r=>a({...t,name:r.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:"#1e293b"},children:"Email *"}),e.jsx("input",{type:"email",value:t.email,onChange:r=>a({...t,email:r.target.value}),required:!0,disabled:!!o,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",backgroundColor:o?"#f8fafc":"white"}}),o&&e.jsx("p",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:"Email não pode ser alterado"})]}),!o&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:"#1e293b"},children:"Senha *"}),e.jsx("input",{type:"password",value:t.password,onChange:r=>a({...t,password:r.target.value}),required:!o,minLength:6,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}}),e.jsx("p",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:"Mínimo de 6 caracteres"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:"#1e293b"},children:"Perfil *"}),e.jsxs("select",{value:t.profile,onChange:r=>a({...t,profile:r.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"attendant",children:"Atendente"}),e.jsx("option",{value:"mechanic",children:"Mecânico"}),e.jsx("option",{value:"financial",children:"Financeiro"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),o&&e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t.active,onChange:r=>a({...t,active:r.target.checked}),style:{width:"18px",height:"18px"}}),e.jsx("span",{style:{fontWeight:"500",color:"#1e293b"},children:"Usuário Ativo"})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.75rem",marginTop:"2rem"},children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),j()},style:{padding:"0.75rem 1.5rem",backgroundColor:"transparent",border:"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer",color:"#64748b",fontWeight:"500"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:o?"Salvar":"Criar"})]})]})]})}),e.jsx(F,{isOpen:m.isOpen,title:"Desativar Usuário",message:`Tem certeza que deseja desativar o usuário "${(B=m.user)==null?void 0:B.name}"?`,confirmText:"Desativar",cancelText:"Cancelar",onConfirm:O,onCancel:()=>x({isOpen:!1,user:null}),type:"danger"})]}):e.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:[e.jsx(K,{size:48,color:"#ef4444",style:{margin:"0 auto 1rem"}}),e.jsx("h2",{children:"Acesso Restrito"}),e.jsx("p",{children:"Apenas administradores podem gerenciar usuários."})]})};export{le as default};
