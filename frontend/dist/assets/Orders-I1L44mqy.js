import{j as e,a as _,b as It,u as Bt}from"./index-DNHKrThd.js";import{r as m,u as Et}from"./react-vendor-BpgKpUzx.js";import{_ as Oe,z as u,$ as Ft,X as qe,R as Tt,a0 as Ue,a1 as At,h as Ge,C as He,W as ze,s as Xe,D as xt,P as Qe,I as bt,c as ut,a2 as gt,F as ye,Q as Pe,a3 as Le,u as ke,q as je,a4 as _e,a5 as Dt,a6 as Ot,N as yt,O as Ye,a7 as jt,a8 as vt,A as qt,g as Pt,E as Lt}from"./ui-vendor-yLLZ9URH.js";import{_ as ft}from"./pdf-vendor-BOaogWDS.js";import{S as Mt}from"./SkeletonLoader-DMsGFzU7.js";import{A as $t}from"./AdvancedFilters-D5PXsfGz.js";import{P as ht}from"./Pagination-MtMwbbp0.js";function Nt({onSave:f,onCancel:D,initialSignature:h}){const i=m.useRef(null),[O,z]=m.useState(!!h);m.useEffect(()=>{const x=i.current;if(!x)return;const d=x.getContext("2d");if(!d)return;const B=x.getBoundingClientRect();if(x.width=B.width,x.height=B.height,d.strokeStyle="#000000",d.lineWidth=2,d.lineCap="round",d.lineJoin="round",h){const E=new Image;E.onload=()=>{d.drawImage(E,0,0,x.width,x.height),z(!0)},E.src=h}let F=!1;const V=E=>{F=!0;const T=x.getBoundingClientRect();d.beginPath(),d.moveTo(E.clientX-T.left,E.clientY-T.top)},k=E=>{if(!F)return;const T=x.getBoundingClientRect();d.lineTo(E.clientX-T.left,E.clientY-T.top),d.stroke(),z(!0)},v=()=>{F=!1},C=E=>{E.preventDefault(),F=!0;const T=x.getBoundingClientRect(),X=E.touches[0];d.beginPath(),d.moveTo(X.clientX-T.left,X.clientY-T.top)},U=E=>{if(E.preventDefault(),!F)return;const T=x.getBoundingClientRect(),X=E.touches[0];d.lineTo(X.clientX-T.left,X.clientY-T.top),d.stroke(),z(!0)},q=E=>{E.preventDefault(),F=!1};return x.addEventListener("mousedown",V),x.addEventListener("mousemove",k),x.addEventListener("mouseup",v),x.addEventListener("mouseleave",v),x.addEventListener("touchstart",C),x.addEventListener("touchmove",U),x.addEventListener("touchend",q),()=>{x.removeEventListener("mousedown",V),x.removeEventListener("mousemove",k),x.removeEventListener("mouseup",v),x.removeEventListener("mouseleave",v),x.removeEventListener("touchstart",C),x.removeEventListener("touchmove",U),x.removeEventListener("touchend",q)}},[h]);const N=()=>{const x=i.current;if(!x)return;const d=x.getContext("2d");d&&(d.clearRect(0,0,x.width,x.height),z(!1))},y=()=>{const x=i.current;if(!x||!O)return;const d=x.toDataURL("image/png");f(d)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("div",{style:{border:"2px solid #e2e8f0",borderRadius:"8px",backgroundColor:"white",position:"relative",width:"100%",height:"200px"},children:e.jsx("canvas",{ref:i,style:{width:"100%",height:"100%",cursor:"crosshair",touchAction:"none"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("button",{type:"button",onClick:N,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:[e.jsx(Oe,{size:16}),"Limpar"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:D,style:{padding:"0.5rem 1rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:"Cancelar"}),e.jsx("button",{type:"button",onClick:y,disabled:!O,style:{padding:"0.5rem 1rem",backgroundColor:O?"#10b981":"#cbd5e1",color:"white",border:"none",borderRadius:"8px",cursor:O?"pointer":"not-allowed",fontWeight:"600",fontSize:"0.875rem"},children:"Salvar Assinatura"})]})]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"#64748b",margin:0},children:"Assine no campo acima usando o mouse ou o dedo (em dispositivos touch)"})]})}const Vt=({orderId:f,onClose:D,onUpdate:h})=>{const[i,O]=m.useState(null),[z,N]=m.useState(!0),[y,x]=m.useState("details"),[d,B]=m.useState(!1),[F,V]=m.useState(null),[k,v]=m.useState({use_installments:!1,installment_count:2,first_due_date:"",payment_method:""}),[C,U]=m.useState([]),[q,E]=m.useState([]),[T,X]=m.useState(!1),[Q,ve]=m.useState(null),[W,Y]=m.useState({}),[de,K]=m.useState(!1),[he,ie]=m.useState(!1),[Z,xe]=m.useState({signed_by_name:""}),[A,ne]=m.useState({file:null,file_type:"photo",description:""});m.useEffect(()=>{f&&(oe(),ce(),Ce())},[f]);const Ce=async()=>{try{const r=await _.get("/workshop-info");V(r.data)}catch(r){console.error("Erro ao carregar informações da oficina:",r)}};m.useEffect(()=>{y==="checklists"&&f&&(Re(),ce())},[y,f]);const oe=async()=>{try{N(!0);const r=await _.get(`/orders/${f}`);O(r.data)}catch(r){u.error("Erro ao carregar ordem de serviço"),console.error(r)}finally{N(!1)}},we=async r=>{var n,o;if(f)try{await _.post(`/orders/${f}/quick-action`,{action:r}),u.success("Ação executada com sucesso!"),oe(),h()}catch(c){u.error(((o=(n=c.response)==null?void 0:n.data)==null?void 0:o.error)||"Erro ao executar ação")}},Re=async()=>{try{const r=await _.get("/checklists?active_only=true");U(r.data)}catch(r){console.error("Erro ao carregar checklists:",r)}},ce=async()=>{if(f)try{const r=await _.get(`/checklists/orders/${f}/executions`);E(r.data)}catch(r){console.error("Erro ao carregar execuções de checklist:",r)}},se=r=>{var o;ve(r);const n={};(o=r.items)==null||o.forEach(c=>{n[c.id]={checked:!1}}),Y(n),X(!0)},We=async()=>{var r,n;if(!(!f||!i||!Q))try{const o=Object.entries(W).map(([c,S])=>({checklist_item_id:parseInt(c),checked:S.checked,value:S.value||null,observation:S.observation||null}));await _.post(`/checklists/orders/${f}/executions`,{checklist_id:Q.id,vehicle_id:i.vehicle_id,items:o}),u.success("Checklist executado com sucesso!"),X(!1),ve(null),Y({}),ce(),oe(),h()}catch(o){u.error(((n=(r=o.response)==null?void 0:r.data)==null?void 0:n.error)||"Erro ao salvar checklist")}},Ie=async(r,n,o)=>{try{await _.put(`/checklists/executions/${r}/items/${n}`,o),ce()}catch{u.error("Erro ao atualizar item do checklist")}},Be=async r=>{var n,o;if(!f||!Z.signed_by_name.trim()){u.error("Nome de quem assinou é obrigatório");return}try{await _.post(`/orders/${f}/signature`,{signature:r,signed_by_name:Z.signed_by_name}),u.success("Assinatura salva com sucesso!"),K(!1),xe({signed_by_name:""}),oe(),h()}catch(c){u.error(((o=(n=c.response)==null?void 0:n.data)==null?void 0:o.error)||"Erro ao salvar assinatura")}},ae=async()=>{if(!f||!A.file){u.error("Selecione um arquivo");return}const r=5*1024*1024;if(A.file.size>r){u.error("Arquivo muito grande. Tamanho máximo: 5MB");return}try{u.loading("Enviando arquivo...",{id:"upload-file"});const n=new FileReader;n.onload=async()=>{var o,c,S;try{const s=n.result.split(",")[1];await _.post(`/orders/${f}/files`,{file_data:s,file_name:A.file.name,file_type:A.file_type,description:A.description||null}),u.success("Arquivo enviado com sucesso!",{id:"upload-file"}),ie(!1),ne({file:null,file_type:"photo",description:""}),oe(),h()}catch(l){const s=((c=(o=l.response)==null?void 0:o.data)==null?void 0:c.error)||"Erro ao enviar arquivo";s.includes("não existe")?u.error("Tabela order_files não encontrada. Execute a migration 007_add_order_signatures_and_files.sql",{id:"upload-file",duration:8e3}):u.error(s,{id:"upload-file"}),console.error("Erro ao enviar arquivo:",((S=l.response)==null?void 0:S.data)||l)}},n.onerror=()=>{u.error("Erro ao ler arquivo",{id:"upload-file"})},n.readAsDataURL(A.file)}catch(n){u.error("Erro ao processar arquivo",{id:"upload-file"}),console.error("Erro ao processar arquivo:",n)}},Ee=async r=>{var n,o;if(!(!f||!confirm("Tem certeza que deseja excluir este arquivo?")))try{await _.delete(`/orders/${f}/files/${r}`),u.success("Arquivo excluído com sucesso!"),oe(),h()}catch(c){u.error(((o=(n=c.response)==null?void 0:n.data)==null?void 0:o.error)||"Erro ao excluir arquivo")}},b=async()=>{var r,n,o;if(!(!f||!i))try{const c={};k.use_installments&&(c.use_installments=!0,c.installment_count=parseInt(k.installment_count.toString()),c.first_due_date=k.first_due_date||new Date().toISOString().split("T")[0]),k.payment_method&&(c.payment_method=k.payment_method),u.loading("Gerando conta a receber...",{id:"generate-receivable"}),await _.post(`/orders/${f}/generate-receivable`,c),u.success("Conta a receber gerada com sucesso!",{id:"generate-receivable"}),B(!1),v({use_installments:!1,installment_count:2,first_due_date:"",payment_method:""}),oe(),h()}catch(c){const S=((n=(r=c.response)==null?void 0:r.data)==null?void 0:n.error)||"Erro ao gerar conta a receber";S.includes("não existe")?u.error("Tabela necessária não encontrada. Execute as migrations do banco de dados.",{id:"generate-receivable",duration:8e3}):u.error(S,{id:"generate-receivable"}),console.error("Erro ao gerar conta a receber:",((o=c.response)==null?void 0:o.data)||c)}},ee=async()=>{if(i)try{u.loading("Gerando PDF da OS...",{id:"export-os-pdf"});const[{default:r},n]=await Promise.all([ft(()=>import("./pdf-vendor-BOaogWDS.js").then(I=>I.j),[]),ft(()=>import("./browser-CTB2jwNe.js").then(I=>I.b),[])]),o=new r("p","mm","a4"),c=210,S=297,l=15;let s=l;const M=I=>s+I>S-l?(o.addPage(),s=l,!0):!1,Fe=JSON.stringify({order_number:i.order_number,order_id:i.id,client:i.client_name,total:i.total,date:new Date().toISOString()}),ue=await n.toDataURL(Fe,{width:200,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});let p=F;if(!p)try{p=(await _.get("/workshop-info")).data}catch(I){console.error("Erro ao carregar informações da oficina:",I)}const Te=p!=null&&p.logo_base64?50:40;if(o.setFillColor(249,115,22),o.rect(0,0,c,Te,"F"),p!=null&&p.logo_base64)try{o.addImage(p.logo_base64,"PNG",l,5,30,30)}catch(I){console.error("Erro ao adicionar logo:",I)}o.setTextColor(255,255,255),o.setFontSize(p!=null&&p.name?16:24),o.setFont("helvetica","bold");const ge=(p==null?void 0:p.name)||"ORDEM DE SERVIÇO";o.text(ge,p!=null&&p.logo_base64?l+35:c/2,p!=null&&p.logo_base64?15:18,{align:p!=null&&p.logo_base64?"left":"center",maxWidth:p!=null&&p.logo_base64?c-l-60:c-2*l}),p!=null&&p.trade_name&&(o.setFontSize(12),o.setFont("helvetica","normal"),o.text(p.trade_name,p!=null&&p.logo_base64?l+35:c/2,22,{align:p!=null&&p.logo_base64?"left":"center",maxWidth:p!=null&&p.logo_base64?c-l-60:c-2*l})),o.setFontSize(18),o.setFont("helvetica","bold"),o.text(i.order_number,c/2,p!=null&&p.logo_base64?35:28,{align:"center"}),o.addImage(ue,"PNG",c-l-25,5,25,25),s=Te+10,o.setTextColor(30,41,59),o.setFontSize(10),o.setFont("helvetica","bold"),o.text("Dados da Ordem de Serviço",l,s),s+=8,o.setFont("helvetica","normal"),o.setFontSize(9),[["Status:",Se(i.status)],["Data de Criação:",pe(i.created_at)],i.started_at?["Data de Início:",pe(i.started_at)]:null,i.finished_at?["Data de Finalização:",pe(i.finished_at)]:null].filter(Boolean).forEach(([I,te])=>{M(8),o.setFont("helvetica","bold"),o.text(I,l,s),o.setFont("helvetica","normal"),o.text(te,l+40,s),s+=6}),s+=5,M(20),o.setFont("helvetica","bold"),o.setFontSize(10),o.text("Cliente",l,s),s+=8,o.setFont("helvetica","normal"),o.setFontSize(9),o.text(i.client_name||"-",l,s),s+=6,o.setFont("helvetica","bold"),o.setFontSize(10),o.text("Veículo",l,s),s+=8,o.setFont("helvetica","normal"),o.setFontSize(9);const Ke=`${i.brand||""} ${i.model||""}`.trim();o.text(Ke||"-",l,s),i.plate&&(s+=6,o.text(`Placa: ${i.plate}`,l,s)),s+=6,i.mechanic_name&&(o.setFont("helvetica","bold"),o.setFontSize(10),o.text("Mecânico",l,s),s+=8,o.setFont("helvetica","normal"),o.setFontSize(9),o.text(i.mechanic_name,l,s),s+=6),s+=5,M(30),o.setFont("helvetica","bold"),o.setFontSize(10),o.text("Itens da Ordem de Serviço",l,s),s+=8,i.items&&i.items.length>0?(o.setFillColor(248,250,252),o.rect(l,s-5,c-2*l,8,"F"),o.setFontSize(8),o.setFont("helvetica","bold"),o.text("Item",l+2,s),o.text("Qtd",c-l-70,s),o.text("Unit.",c-l-50,s),o.text("Total",c-l-25,s),s+=8,o.setFont("helvetica","normal"),i.items.forEach((I,te)=>{M(10),te%2===0?o.setFillColor(255,255,255):o.setFillColor(248,250,252),o.rect(l,s-4,c-2*l,7,"F"),o.setFontSize(8),o.text(I.description||"-",l+2,s),o.text(I.quantity.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}),c-l-70,s,{align:"right"}),o.text(me(I.unit_price),c-l-50,s,{align:"right"}),o.text(me(I.total_price),c-l-25,s,{align:"right"}),s+=7})):(o.setFontSize(9),o.text("Nenhum item adicionado",l,s),s+=6),s+=5,M(25),o.setFont("helvetica","bold"),o.setFontSize(10),o.text("Resumo Financeiro",l,s),s+=8,o.setFontSize(9),o.setFont("helvetica","normal"),o.text("Subtotal:",c-l-50,s),o.text(me(i.subtotal),c-l-5,s,{align:"right"}),s+=7,o.text("Desconto:",c-l-50,s),o.text(me(i.discount),c-l-5,s,{align:"right"}),s+=7,o.setFillColor(16,185,129,.1),o.rect(l,s-5,c-2*l,8,"F"),o.setFont("helvetica","bold"),o.setFontSize(11),o.setTextColor(16,185,129),o.text("TOTAL:",c-l-50,s),o.text(me(i.total),c-l-5,s,{align:"right"}),o.setTextColor(30,41,59),s+=10,M(20),i.technical_notes&&(o.setFont("helvetica","bold"),o.setFontSize(10),o.text("Observações Técnicas",l,s),s+=8,o.setFont("helvetica","normal"),o.setFontSize(9),o.splitTextToSize(i.technical_notes,c-2*l).forEach(te=>{M(6),o.text(te,l,s),s+=6}),s+=5),M(30),s<S-40&&(o.setFont("helvetica","bold"),o.setFontSize(9),o.setTextColor(30,41,59),o.text("Rastreamento",l,s),s+=8,o.setFont("helvetica","normal"),o.setFontSize(8),o.setTextColor(100,116,139),o.text("Escaneie o QR Code para acessar informações desta OS",l,s),s+=6,o.text(`Número da OS: ${i.order_number}`,l,s),s+=5,o.addImage(ue,"PNG",l,s,20,20),s+=25);const Me=o.getNumberOfPages();for(let I=1;I<=Me;I++){o.setPage(I),o.setFontSize(8),o.setTextColor(100,116,139);const te=(p==null?void 0:p.footer_text)||`Página ${I} de ${Me} - Gerado em ${new Date().toLocaleString("pt-BR")}`;if(o.text(te,c/2,S-10,{align:"center",maxWidth:c-2*l}),p&&(p.phone||p.email||p.address_city)){let re="";p.phone&&(re+=`Tel: ${p.phone}`),p.email&&(re+=(re?" | ":"")+`Email: ${p.email}`),p.address_city&&(re+=(re?" | ":"")+`${p.address_city}${p.address_state?"/"+p.address_state:""}`),re&&(o.setFontSize(7),o.text(re,c/2,S-5,{align:"center",maxWidth:c-2*l}))}}const $e=`OS_${i.order_number}_${new Date().toISOString().split("T")[0]}.pdf`;o.save($e),u.success("PDF gerado com sucesso!",{id:"export-os-pdf"})}catch(r){console.error("Erro ao gerar PDF:",r),u.error("Erro ao gerar PDF da OS",{id:"export-os-pdf"}),window.print()}},G=r=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r),me=r=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}).format(r),P=r=>r?new Date(r).toLocaleString("pt-BR"):"-",pe=r=>r?new Date(r).toLocaleDateString("pt-BR")+" "+new Date(r).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):"-",L=r=>({open:"#64748b",in_progress:"#3b82f6",waiting_parts:"#f59e0b",finished:"#10b981",cancelled:"#ef4444"})[r]||"#64748b",Se=r=>({open:"Aberta",in_progress:"Em Andamento",waiting_parts:"Aguardando Peças",finished:"Finalizada",cancelled:"Cancelada"})[r]||r,w=()=>{if(!i)return[];const r=[];return i.status==="open"&&r.push({action:"start",label:"Iniciar OS",icon:Le,color:"#3b82f6"}),i.status==="in_progress"&&(r.push({action:"finish",label:"Finalizar OS",icon:ke,color:"#10b981"}),r.push({action:"wait_parts",label:"Aguardar Peças",icon:je,color:"#f59e0b"})),i.status==="waiting_parts"&&r.push({action:"start",label:"Retomar OS",icon:Le,color:"#3b82f6"}),(i.status==="finished"||i.status==="cancelled")&&r.push({action:"reopen",label:"Reabrir OS",icon:Oe,color:"#64748b"}),i.status!=="cancelled"&&i.status!=="finished"&&r.push({action:"cancel",label:"Cancelar OS",icon:_e,color:"#ef4444"}),r};return f?z?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002},children:e.jsx("div",{style:{color:"white"},children:"Carregando..."})}):i?e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:D,children:[e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",width:"100%",maxWidth:"1000px",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"0.5rem"},children:i.order_number}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:L(i.status)+"20",color:L(i.status)},children:Se(i.status)}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:["Criada em ",P(i.created_at)]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{onClick:ee,style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},title:"Gerar PDF da OS",children:[e.jsx(Ft,{size:20,color:"#64748b"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:"PDF"})]}),e.jsx("button",{onClick:D,style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer"},children:e.jsx(qe,{size:20,color:"#64748b"})})]})]}),(w().length>0||i.status==="finished")&&e.jsxs("div",{style:{padding:"1rem 1.5rem",backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0",display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[w().map(r=>{const n=r.icon;return e.jsxs("button",{onClick:()=>we(r.action),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:r.color+"20",color:r.color,border:`1px solid ${r.color}40`,borderRadius:"6px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem",transition:"all 0.2s"},onMouseEnter:o=>{o.currentTarget.style.backgroundColor=r.color+"30"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor=r.color+"20"},children:[e.jsx(n,{size:18}),r.label]},r.action)}),i.status==="finished"&&e.jsxs("button",{onClick:()=>B(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#f9731620",color:"#f97316",border:"1px solid #f9731640",borderRadius:"6px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#f9731630"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#f9731620"},children:[e.jsx(Tt,{size:18}),"Gerar Conta a Receber"]})]}),e.jsx("div",{style:{display:"flex",borderBottom:"1px solid #e2e8f0"},children:[{id:"details",label:"Detalhes"},{id:"items",label:"Itens"},{id:"checklists",label:"Checklists"},{id:"signature",label:"Assinatura",icon:Ue},{id:"files",label:"Fotos/Docs",icon:At},{id:"history",label:"Histórico"}].map(r=>e.jsxs("button",{onClick:()=>x(r.id),style:{padding:"1rem 1.5rem",border:"none",backgroundColor:y===r.id?"white":"#f8fafc",borderBottom:y===r.id?"2px solid #f97316":"2px solid transparent",cursor:"pointer",fontWeight:y===r.id?"600":"400",color:y===r.id?"#1e293b":"#64748b"},children:[r.icon&&e.jsx(r.icon,{size:16,style:{marginRight:"0.5rem"}}),r.label]},r.id))}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem"},children:[y==="details"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Ge,{size:18,color:"#64748b"}),"Cliente"]}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:e.jsx("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:i.client_name})})]}),e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(He,{size:18,color:"#64748b"}),"Veículo"]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:[i.brand," ",i.model]}),i.plate&&e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:["Placa: ",i.plate]})]})]}),i.mechanic_name&&e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ze,{size:18,color:"#64748b"}),"Mecânico"]}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:e.jsx("div",{style:{fontWeight:"600"},children:i.mechanic_name})})]}),e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Xe,{size:18,color:"#64748b"}),"Datas"]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[i.started_at&&e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Iniciada em:"}),e.jsx("div",{style:{fontWeight:"600"},children:P(i.started_at)})]}),i.finished_at&&e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Finalizada em:"}),e.jsx("div",{style:{fontWeight:"600"},children:P(i.finished_at)})]})]})]}),i.technical_notes&&e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1rem"},children:"Observações Técnicas"}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",whiteSpace:"pre-wrap"},children:i.technical_notes})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsxs("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(xt,{size:18,color:"#64748b"}),"Valores"]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Subtotal:"}),e.jsx("span",{style:{fontWeight:"600"},children:G(i.subtotal)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Desconto:"}),e.jsx("span",{style:{fontWeight:"600"},children:G(i.discount)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"0.5rem",borderTop:"1px solid #e2e8f0",marginTop:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:"600",fontSize:"1.1rem"},children:"Total:"}),e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.2rem",color:"#10b981"},children:G(i.total)})]})]})]})]}),y==="items"&&e.jsx("div",{children:i.items&&i.items.length>0?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Item"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Qtd"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Unit."}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Total"})]})}),e.jsx("tbody",{children:i.items.map(r=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.item_type==="product"?e.jsx(Qe,{size:16,color:"#3b82f6"}):e.jsx(ze,{size:16,color:"#f97316"}),e.jsx("span",{style:{fontWeight:"600"},children:r.description})]})}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",color:"#64748b"},children:r.quantity}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",color:"#64748b"},children:G(r.unit_price)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:G(r.total_price)})]},r.id))})]}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:"Nenhum item adicionado"})}),y==="checklists"&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600"},children:"Checklists Executados"}),e.jsxs("button",{onClick:()=>{Re()},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:[e.jsx(bt,{size:16}),"Executar Checklist"]})]}),C.length>0&&e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h4",{style:{fontSize:"0.9rem",fontWeight:"600",marginBottom:"1rem",color:"#64748b"},children:"Checklists Disponíveis"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"1rem"},children:C.map(r=>{var n;return e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:o=>{o.currentTarget.style.backgroundColor="#eff6ff",o.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="#f8fafc",o.currentTarget.style.borderColor="#e2e8f0"},onClick:()=>se(r),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(ut,{size:18,color:"#3b82f6"}),e.jsx("span",{style:{fontWeight:"600",color:"#1e293b"},children:r.name})]}),r.description&&e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginBottom:"0.5rem"},children:r.description}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[((n=r.items)==null?void 0:n.length)||0," itens"]})]},r.id)})})]}),q.length>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:q.map(r=>e.jsxs("div",{style:{padding:"1.5rem",backgroundColor:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"1rem"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(ut,{size:20,color:"#3b82f6"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"600",color:"#1e293b"},children:r.checklist_name})]}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:["Executado em ",P(r.executed_at),r.mechanic_name&&` por ${r.mechanic_name}`]})]})}),r.items&&r.items.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.items.map(n=>e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"white",borderRadius:"8px",border:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("input",{type:"checkbox",checked:n.checked||!1,onChange:o=>{Ie(r.id,n.checklist_item_id,{checked:o.target.checked})},style:{width:"18px",height:"18px",cursor:"pointer"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"0.875rem",fontWeight:n.required?"600":"400",color:"#1e293b"},children:n.item_description}),n.item_type==="measure"&&n.value&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:["Valor: ",n.value]}),n.observation&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem",fontStyle:"italic"},children:["Obs: ",n.observation]})]}),n.item_type==="measure"&&e.jsx("input",{type:"text",placeholder:"Valor",value:n.value||"",onChange:o=>{Ie(r.id,n.checklist_item_id,{value:o.target.value})},style:{padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",width:"120px"}})]},n.id))}),r.notes&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"8px",fontSize:"0.875rem",color:"#92400e"},children:[e.jsx("strong",{children:"Observações:"})," ",r.notes]})]},r.id))}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:"Nenhum checklist executado ainda. Selecione um checklist acima para começar."})]}),y==="signature"&&e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1.5rem"},children:"Assinatura do Cliente"}),i.client_signature?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsx("div",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:"Assinatura registrada"}),e.jsx("img",{src:i.client_signature,alt:"Assinatura do cliente",style:{maxWidth:"100%",border:"1px solid #e2e8f0",borderRadius:"8px",backgroundColor:"white",padding:"1rem"}}),i.signed_by_name&&e.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.875rem",color:"#64748b"},children:["Assinado por: ",e.jsx("strong",{children:i.signed_by_name})]}),i.signature_date&&e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:["Em: ",P(i.signature_date)]})]}),e.jsxs("button",{onClick:()=>K(!0),style:{padding:"0.75rem 1.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Ue,{size:18}),"Alterar Assinatura"]})]}):e.jsxs("div",{children:[e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b",marginBottom:"1.5rem",border:"1px dashed #e2e8f0",borderRadius:"8px"},children:"Nenhuma assinatura registrada ainda."}),e.jsxs("button",{onClick:()=>K(!0),style:{padding:"0.75rem 1.5rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Ue,{size:18}),"Capturar Assinatura"]})]})]}),y==="files"&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600"},children:"Fotos e Documentos"}),e.jsxs("button",{onClick:()=>ie(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:[e.jsx(gt,{size:16}),"Upload Arquivo"]})]}),i.files&&i.files.length>0?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"1rem"},children:i.files.map(r=>e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[r.file_type==="photo"&&r.file_path?e.jsx("img",{src:`data:image/jpeg;base64,${r.file_path}`,alt:r.description||r.file_name,style:{width:"100%",height:"150px",objectFit:"cover",borderRadius:"6px",marginBottom:"0.5rem",cursor:"pointer"},onClick:()=>{const n=`data:image/jpeg;base64,${r.file_path}`,o=document.createElement("div");o.setAttribute("role","dialog"),o.setAttribute("aria-modal","true"),o.setAttribute("aria-label","Visualizar imagem"),Object.assign(o.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"10000",cursor:"pointer"});const c=document.createElement("img");c.src=n,c.alt=r.description||r.file_name,Object.assign(c.style,{maxWidth:"90%",maxHeight:"90%",objectFit:"contain",borderRadius:"8px",cursor:"default"});const S=document.createElement("button");S.innerHTML="✕",S.setAttribute("aria-label","Fechar"),Object.assign(S.style,{position:"absolute",top:"20px",right:"20px",backgroundColor:"rgba(255, 255, 255, 0.9)",border:"none",borderRadius:"50%",width:"40px",height:"40px",fontSize:"24px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"#1e293b",zIndex:"10001"});const l=()=>{document.body.contains(o)&&document.body.removeChild(o),document.removeEventListener("keydown",s)};S.onclick=M=>{M.stopPropagation(),l()},o.onclick=M=>{M.target===o&&l()};const s=M=>{M.key==="Escape"&&l()};o.appendChild(c),o.appendChild(S),document.body.appendChild(o),document.addEventListener("keydown",s),o.focus()},loading:"lazy",crossOrigin:"anonymous"}):e.jsx("div",{style:{width:"100%",height:"150px",backgroundColor:"#e2e8f0",borderRadius:"6px",marginBottom:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ye,{size:48,color:"#64748b"})}),e.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"600",marginBottom:"0.25rem",color:"#1e293b"},children:r.file_name}),r.description&&e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginBottom:"0.5rem"},children:r.description}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b",marginBottom:"0.5rem"},children:[P(r.created_at),r.uploaded_by_name&&` • ${r.uploaded_by_name}`]}),e.jsxs("button",{onClick:()=>Ee(r.id),style:{width:"100%",padding:"0.5rem",backgroundColor:"#fee2e2",color:"#ef4444",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",fontSize:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(Pe,{size:14}),"Excluir"]})]},r.id))}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b",border:"1px dashed #e2e8f0",borderRadius:"8px"},children:'Nenhum arquivo enviado ainda. Clique em "Upload Arquivo" para começar.'})]}),y==="history"&&e.jsx("div",{children:i.history&&i.history.length>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:i.history.map(r=>e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",borderLeft:"3px solid #f97316"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{fontWeight:"600"},children:r.field_changed}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:P(r.created_at)})]}),r.old_value&&r.new_value&&e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.25rem"},children:[r.old_value," → ",r.new_value]}),r.notes&&e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b",fontStyle:"italic"},children:r.notes}),r.changed_by_name&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#94a3b8",marginTop:"0.5rem"},children:["Por: ",r.changed_by_name]})]},r.id))}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:"Nenhum histórico registrado"})})]})]}),d&&i&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1003},onClick:()=>B(!1),children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"500px"},onClick:r=>r.stopPropagation(),children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1.5rem"},children:"Gerar Conta a Receber"}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",marginBottom:"1rem"},children:[e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem"},children:["OS: ",i.order_number]}),e.jsx("div",{style:{fontSize:"1.25rem",fontWeight:"bold",color:"#1e293b"},children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.total)})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",fontWeight:"600",cursor:"pointer",marginBottom:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:k.use_installments,onChange:r=>v({...k,use_installments:r.target.checked}),style:{cursor:"pointer"}}),"Dividir em parcelas"]})}),k.use_installments&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Número de Parcelas"}),e.jsx("input",{type:"number",min:"2",max:"24",value:k.installment_count,onChange:r=>v({...k,installment_count:parseInt(r.target.value)||2}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Data da Primeira Parcela"}),e.jsx("input",{type:"date",value:k.first_due_date,onChange:r=>v({...k,first_due_date:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]})]}),!k.use_installments&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Data de Vencimento (padrão: 30 dias)"}),e.jsx("input",{type:"date",value:k.first_due_date,onChange:r=>v({...k,first_due_date:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Método de Pagamento (opcional)"}),e.jsxs("select",{value:k.payment_method,onChange:r=>v({...k,payment_method:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"",children:"Selecione (opcional)"}),e.jsx("option",{value:"cash",children:"Dinheiro"}),e.jsx("option",{value:"credit_card",children:"Cartão de Crédito"}),e.jsx("option",{value:"debit_card",children:"Cartão de Débito"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"bank_transfer",children:"Transferência Bancária"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>B(!1),style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{onClick:b,style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Gerar Conta"})]})]})}),T&&Q&&i&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1003,padding:"1rem"},onClick:()=>{X(!1),ve(null),Y({})},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"700px",maxHeight:"90vh",overflowY:"auto"},onClick:r=>r.stopPropagation(),children:[e.jsxs("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1rem"},children:["Executar Checklist: ",Q.name]}),Q.description&&e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1.5rem"},children:Q.description}),Q.items&&Q.items.length>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:Q.items.map(r=>{var n,o,c;return e.jsx("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:e.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"1rem"},children:[r.item_type==="check"&&e.jsx("input",{type:"checkbox",checked:((n=W[r.id])==null?void 0:n.checked)||!1,onChange:S=>{Y({...W,[r.id]:{...W[r.id],checked:S.target.checked}})},style:{width:"20px",height:"20px",cursor:"pointer",marginTop:"2px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:r.required?"600":"400",color:"#1e293b"},children:r.description}),r.required&&e.jsx("span",{style:{fontSize:"0.75rem",padding:"0.125rem 0.5rem",backgroundColor:"#ef444420",color:"#ef4444",borderRadius:"4px",fontWeight:"600"},children:"Obrigatório"})]}),r.item_type==="measure"&&e.jsx("input",{type:"text",placeholder:"Informe o valor medido",value:((o=W[r.id])==null?void 0:o.value)||"",onChange:S=>{Y({...W,[r.id]:{...W[r.id],value:S.target.value}})},style:{width:"100%",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",marginTop:"0.5rem"}}),(r.item_type==="observation"||r.item_type==="check"||r.item_type==="measure")&&e.jsx("textarea",{placeholder:"Observações (opcional)",value:((c=W[r.id])==null?void 0:c.observation)||"",onChange:S=>{Y({...W,[r.id]:{...W[r.id],observation:S.target.value}})},rows:2,style:{width:"100%",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",marginTop:"0.5rem",resize:"vertical"}})]})]})},r.id)})}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:"Este checklist não possui itens."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{X(!1),ve(null),Y({})},style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{type:"button",onClick:We,style:{padding:"0.75rem 1.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Salvar Checklist"})]})]})}),de&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1003,padding:"1rem"},onClick:()=>{K(!1),xe({signed_by_name:""})},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"600px"},onClick:r=>r.stopPropagation(),children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1.5rem"},children:"Capturar Assinatura do Cliente"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Nome de quem está assinando *"}),e.jsx("input",{type:"text",value:Z.signed_by_name,onChange:r=>xe({signed_by_name:r.target.value}),placeholder:"Nome completo",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsx(Nt,{onSave:Be,onCancel:()=>{K(!1),xe({signed_by_name:""})},initialSignature:i==null?void 0:i.client_signature})]})}),he&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1003,padding:"1rem"},onClick:()=>{ie(!1),ne({file:null,file_type:"photo",description:""})},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"500px"},onClick:r=>r.stopPropagation(),children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1.5rem"},children:"Upload de Arquivo"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Tipo de Arquivo"}),e.jsxs("select",{value:A.file_type,onChange:r=>ne({...A,file_type:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"photo",children:"Foto"}),e.jsx("option",{value:"document",children:"Documento"}),e.jsx("option",{value:"other",children:"Outro"})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Arquivo *"}),e.jsx("input",{type:"file",accept:"image/*,.pdf,.doc,.docx",onChange:r=>{var o;const n=(o=r.target.files)==null?void 0:o[0];if(n){if(n.size>5*1024*1024){u.error("Arquivo muito grande. Máximo 5MB");return}ne({...A,file:n})}},style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Descrição (opcional)"}),e.jsx("textarea",{value:A.description,onChange:r=>ne({...A,description:r.target.value}),rows:3,placeholder:"Descrição do arquivo...",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",resize:"vertical"}})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{ie(!1),ne({file:null,file_type:"photo",description:""})},style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsxs("button",{type:"button",onClick:ae,disabled:!A.file,style:{padding:"0.75rem 1.5rem",backgroundColor:A.file?"#3b82f6":"#cbd5e1",color:"white",border:"none",borderRadius:"8px",cursor:A.file?"pointer":"not-allowed",fontWeight:"600"},children:[e.jsx(gt,{size:18,style:{marginRight:"0.5rem",display:"inline-block",verticalAlign:"middle"}}),"Enviar"]})]})]})})]}):null:null},be=({status:f,onClick:D,active:h=!1,size:i="md"})=>{const z=(d=>{const B={open:{label:"Aberta",color:"#64748b",bgColor:"#f1f5f9",icon:Dt},in_progress:{label:"Em Andamento",color:"#3b82f6",bgColor:"#eff6ff",icon:Xe},waiting_parts:{label:"Aguardando Peças",color:"#f59e0b",bgColor:"#fffbeb",icon:je},finished:{label:"Finalizada",color:"#10b981",bgColor:"#f0fdf4",icon:ke},cancelled:{label:"Cancelada",color:"#ef4444",bgColor:"#fef2f2",icon:_e}};return B[d]||B.open})(f),N=z.icon,x={sm:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",iconSize:14},md:{padding:"0.5rem 1rem",fontSize:"0.875rem",iconSize:16},lg:{padding:"0.75rem 1.5rem",fontSize:"1rem",iconSize:18}}[i];return e.jsxs("div",{onClick:D,style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:x.padding,backgroundColor:h?z.color:z.bgColor,color:h?"white":z.color,borderRadius:"8px",fontSize:x.fontSize,fontWeight:"600",cursor:D?"pointer":"default",border:h?`2px solid ${z.color}`:"2px solid transparent",transition:"all 0.2s",whiteSpace:"nowrap"},onMouseEnter:d=>{D&&!h&&(d.currentTarget.style.backgroundColor=z.bgColor,d.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:d=>{D&&!h&&(d.currentTarget.style.backgroundColor=z.bgColor,d.currentTarget.style.transform="translateY(0)")},children:[e.jsx(N,{size:x.iconSize}),e.jsx("span",{children:z.label})]})},Ct=({order:f,onAction:D,loading:h=!1})=>{const[i,O]=m.useState(!1),z=m.useRef(null);m.useEffect(()=>{const d=B=>{z.current&&!z.current.contains(B.target)&&O(!1)};return i&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[i]);const y=(()=>{const d=[];switch(f.status){case"open":d.push({action:"start",label:"Iniciar OS",icon:Le,color:"#3b82f6",bgColor:"#eff6ff"},{action:"wait_parts",label:"Aguardar Peças",icon:je,color:"#f59e0b",bgColor:"#fffbeb"},{action:"cancel",label:"Cancelar",icon:_e,color:"#ef4444",bgColor:"#fee2e2"});break;case"in_progress":d.push({action:"finish",label:"Finalizar OS",icon:ke,color:"#10b981",bgColor:"#f0fdf4"},{action:"wait_parts",label:"Aguardar Peças",icon:je,color:"#f59e0b",bgColor:"#fffbeb"},{action:"cancel",label:"Cancelar",icon:_e,color:"#ef4444",bgColor:"#fee2e2"});break;case"waiting_parts":d.push({action:"start",label:"Retomar OS",icon:Le,color:"#3b82f6",bgColor:"#eff6ff"},{action:"finish",label:"Finalizar OS",icon:ke,color:"#10b981",bgColor:"#f0fdf4"},{action:"cancel",label:"Cancelar",icon:_e,color:"#ef4444",bgColor:"#fee2e2"});break;case"finished":d.push({action:"reopen",label:"Reabrir OS",icon:Oe,color:"#64748b",bgColor:"#f1f5f9"});break;case"cancelled":d.push({action:"reopen",label:"Reabrir OS",icon:Oe,color:"#64748b",bgColor:"#f1f5f9"});break}return d})();if(y.length===0)return null;const x=d=>{D(f.id,d),O(!1)};return e.jsxs("div",{ref:z,style:{position:"relative"},children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),O(!i)},disabled:h,style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:h?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:h?.6:1},title:"Ações rápidas",children:e.jsx(Ot,{size:16,color:"#64748b"})}),i&&e.jsx("div",{style:{position:"absolute",right:0,top:"100%",marginTop:"0.5rem",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)",border:"1px solid #e2e8f0",zIndex:1e3,minWidth:"180px",overflow:"hidden"},children:y.map(d=>{const B=d.icon;return e.jsxs("button",{onClick:F=>{F.stopPropagation(),x(d.action)},style:{width:"100%",padding:"0.75rem 1rem",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"0.875rem",color:"#1e293b",transition:"background-color 0.2s",textAlign:"left"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor=d.bgColor},onMouseLeave:F=>{F.currentTarget.style.backgroundColor="transparent"},children:[e.jsx(B,{size:16,color:d.color}),e.jsx("span",{children:d.label})]},d.action)})})]})},Ut=({order:f,onEdit:D,onDelete:h,onView:i,onViewItems:O,onQuickAction:z,onAssume:N,onTransfer:y,currentUserId:x,currentUserProfile:d,formatCurrency:B,getStatusLabel:F,loading:V=!1})=>{const k=v=>v?new Date(v).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-";return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",border:"1px solid #e2e8f0",transition:"all 0.2s",cursor:"pointer"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 4px 6px -1px rgb(0 0 0 / 0.1)",v.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 1px 3px 0 rgb(0 0 0 / 0.1)",v.currentTarget.style.transform="translateY(0)"},onClick:()=>i(f.id),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx(ye,{size:20,color:"#f97316"}),e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"bold",color:"#1e293b",margin:0},children:f.order_number})]}),e.jsx(be,{status:f.status,size:"sm"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),i(f.id)},style:{padding:"0.5rem",backgroundColor:"#eff6ff",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Ver detalhes",children:e.jsx(yt,{size:16,color:"#3b82f6"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),D(f)},style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Editar",children:e.jsx(Ye,{size:16,color:"#64748b"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),h(f.id)},style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Excluir",children:e.jsx(Pe,{size:16,color:"#ef4444"})})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Ge,{size:16,color:"#64748b"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#1e293b",fontWeight:"500"},children:f.client_name||"Cliente não informado"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(He,{size:16,color:"#64748b"}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:[f.brand," ",f.model," ",f.plate?`- ${f.plate}`:""]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[f.mechanic_name?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ze,{size:16,color:"#64748b"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:f.mechanic_name})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ze,{size:16,color:"#94a3b8"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#94a3b8",fontStyle:"italic"},children:"Sem mecânico"})]}),(d==="admin"||d==="mechanic"||d==="attendant")&&f.status!=="finished"&&f.status!=="cancelled"&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginTop:"0.25rem"},children:[(!f.mechanic_id||f.mechanic_id!==x)&&N&&(d==="admin"||d==="mechanic")&&e.jsxs("button",{onClick:v=>{v.stopPropagation(),N(f.id)},disabled:V,style:{padding:"0.375rem 0.75rem",backgroundColor:"#e0e7ff",border:"none",borderRadius:"6px",cursor:V?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500",color:"#6366f1",opacity:V?.5:1},title:"Assumir OS",children:[e.jsx(jt,{size:14}),"Assumir"]}),y&&e.jsxs("button",{onClick:v=>{v.stopPropagation(),y(f)},style:{padding:"0.375rem 0.75rem",backgroundColor:"#fef3c7",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500",color:"#f59e0b"},title:"Transferir OS",children:[e.jsx(vt,{size:14}),"Transferir"]})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginBottom:"0.25rem"},children:"Total"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"bold",color:"#1e293b"},children:B(f.total)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginBottom:"0.25rem"},children:"Criada em"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#1e293b"},children:k(f.created_at)})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("button",{onClick:v=>{v.stopPropagation(),O(f)},style:{flex:1,padding:"0.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(ye,{size:14}),"Ver Itens"]}),z&&e.jsx(Ct,{order:f,onAction:z,loading:V})]})]})},Qt=({orderId:f,orderNumber:D,currentMechanicName:h,onClose:i,onSuccess:O})=>{const[z,N]=m.useState([]),[y,x]=m.useState(null),[d,B]=m.useState(!1),[F,V]=m.useState(!0);m.useEffect(()=>{k()},[]);const k=async()=>{try{V(!0);const C=await _.get("/users/mechanics");N(C.data)}catch(C){console.error("Erro ao carregar mecânicos:",C),u.error("Erro ao carregar lista de mecânicos")}finally{V(!1)}},v=async()=>{var C,U;if(!y){u.error("Selecione um mecânico");return}try{B(!0),await _.post(`/orders/${f}/transfer`,{mechanic_id:y}),u.success("OS transferida com sucesso!"),O(),i()}catch(q){console.error("Erro ao transferir OS:",q),u.error(((U=(C=q.response)==null?void 0:C.data)==null?void 0:U.error)||"Erro ao transferir ordem de serviço")}finally{B(!1)}};return z.find(C=>C.id===y),e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:i,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",width:"90%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"},onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1e293b",margin:0},children:["Transferir OS #",D]}),h&&e.jsxs("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:"0.25rem 0 0 0"},children:["Mecânico atual: ",h]})]}),e.jsx("button",{onClick:i,style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",color:"#64748b",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor="#f1f5f9"},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="transparent"},children:e.jsx(qe,{size:20})})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.75rem"},children:"Selecione o mecânico:"}),F?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:"Carregando mecânicos..."}):z.length===0?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:"Nenhum mecânico disponível"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",maxHeight:"300px",overflowY:"auto"},children:z.map(C=>e.jsxs("button",{onClick:()=>x(C.id),style:{padding:"1rem",backgroundColor:y===C.id?"#e0e7ff":"#f8fafc",border:`2px solid ${y===C.id?"#6366f1":"#e2e8f0"}`,borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.75rem",transition:"all 0.2s",textAlign:"left"},onMouseEnter:U=>{y!==C.id&&(U.currentTarget.style.backgroundColor="#f1f5f9")},onMouseLeave:U=>{y!==C.id&&(U.currentTarget.style.backgroundColor="#f8fafc")},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:y===C.id?"#6366f1":"#cbd5e1",display:"flex",alignItems:"center",justifyContent:"center",color:"white",flexShrink:0},children:e.jsx(Ge,{size:20})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:y===C.id?"600":"500",color:"#1e293b",marginBottom:"0.25rem"},children:C.name}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:C.email})]}),y===C.id&&e.jsx("div",{style:{color:"#6366f1"},children:e.jsx(qt,{size:20})})]},C.id))})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:i,disabled:d,style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:d?"not-allowed":"pointer",fontWeight:"600",opacity:d?.5:1},children:"Cancelar"}),e.jsx("button",{onClick:v,disabled:d||!y,style:{padding:"0.75rem 1.5rem",backgroundColor:y?"#6366f1":"#cbd5e1",color:"white",border:"none",borderRadius:"8px",cursor:d||!y?"not-allowed":"pointer",fontWeight:"600",opacity:d?.5:1,display:"flex",alignItems:"center",gap:"0.5rem"},children:d?"Transferindo...":"Transferir OS"})]})]})})},er=()=>{var lt,dt,ct,mt,pt;const f=Et(),{isMobile:D}=It(),{user:h}=Bt(),[i,O]=m.useState([]),[z,N]=m.useState([]),[y,x]=m.useState([]),[d,B]=m.useState([]),[F,V]=m.useState([]),[k,v]=m.useState([]),[C,U]=m.useState(!0),[q,E]=m.useState(""),[T,X]=m.useState({}),[Q,ve]=m.useState(""),[W,Y]=m.useState(""),[de,K]=m.useState(null),[he,ie]=m.useState(1),[Z]=m.useState(10),[xe,A]=m.useState(!1),[ne,Ce]=m.useState(!1),[oe,we]=m.useState(!1),[Re,ce]=m.useState(!1),[se,We]=m.useState(null),[Ie,Be]=m.useState(null),[ae,Ee]=m.useState(null),[b,ee]=m.useState(null),[G,me]=m.useState(null),[P,pe]=m.useState([]),[L,Se]=m.useState(null),[w,r]=m.useState({client_id:"",vehicle_id:"",mechanic_id:"",status:"open",discount:"0",technical_notes:"",template_id:""}),[n,o]=m.useState({item_type:"product",product_id:"",labor_id:"",description:"",quantity:"1",unit_price:"0"}),[c,S]=m.useState(0);m.useEffect(()=>{s(),M(),ue(),p(),Te(),l()},[q,Q,T]),m.useEffect(()=>{ie(1)},[T,q,Q]);const l=async()=>{try{const t=await _.get("/orders/statistics/overview");me(t.data)}catch(t){console.error("Erro ao carregar estatísticas:",t)}},s=async()=>{try{U(!0);const t={};q&&(t.search=q),Q&&(t.status=Q),Object.entries(T).forEach(([g,j])=>{j&&(t[g]=j)});const a=await _.get("/orders",{params:t});O(a.data)}catch(t){u.error("Erro ao carregar ordens de serviço"),console.error(t)}finally{U(!1)}},M=async()=>{try{const t=await _.get("/clients");N(t.data)}catch(t){console.error("Erro ao carregar clientes:",t)}},Fe=async t=>{try{const a=t?{client_id:t}:{},g=await _.get("/vehicles",{params:a});x(g.data)}catch(a){console.error("Erro ao carregar veículos:",a)}},ue=async()=>{try{const t=await _.get("/products");B(t.data)}catch(t){console.error("Erro ao carregar produtos:",t)}},p=async()=>{try{const t=await _.get("/labor-types",{params:{active:"true"}});V(t.data)}catch(t){console.error("Erro ao carregar tipos de mão de obra:",t)}},Te=async()=>{try{const t=await _.get("/order-templates?active_only=true");v(t.data)}catch(t){console.error("Erro ao carregar templates de OS:",t)}},ge=async t=>{try{const a=await _.get(`/orders/${t}`);pe(a.data.items||[])}catch(a){console.error("Erro ao carregar itens:",a)}},Je=async t=>{var a,g;t.preventDefault();try{const j={client_id:parseInt(w.client_id),vehicle_id:parseInt(w.vehicle_id),mechanic_id:w.mechanic_id?parseInt(w.mechanic_id):null,discount:parseFloat(w.discount)||0,status:w.status,technical_notes:w.technical_notes};!ae&&w.template_id&&(j.template_id=parseInt(w.template_id)),ae?(await _.put(`/orders/${ae.id}`,j),u.success("Ordem de serviço atualizada com sucesso!")):(await _.post("/orders",j),u.success("Ordem de serviço criada com sucesso!")),A(!1),Ae(),s(),l()}catch(j){u.error(((g=(a=j.response)==null?void 0:a.data)==null?void 0:g.error)||"Erro ao salvar ordem de serviço")}},$e=L?async t=>{var j,R;if(t.preventDefault(),!b||!L)return;if(!n.description.trim()){u.error("Descrição é obrigatória");return}const a=parseFloat(n.quantity),g=parseFloat(n.unit_price);if(a<=0){u.error("Quantidade deve ser maior que zero");return}if(g<=0){u.error("Preço unitário deve ser maior que zero");return}try{const $={description:n.description,quantity:a,unit_price:g};await _.put(`/orders/${b.id}/items/${L.id}`,$),u.success("Item atualizado com sucesso!"),De(),await ge(b.id);const J=await _.get(`/orders/${b.id}`);ee(J.data),s(),ue(),l()}catch($){u.error(((R=(j=$.response)==null?void 0:j.data)==null?void 0:R.error)||"Erro ao atualizar item")}}:async t=>{var j,R;if(t.preventDefault(),!b)return;if(!n.description.trim()){u.error("Descrição é obrigatória");return}const a=parseFloat(n.quantity),g=parseFloat(n.unit_price);if(a<=0){u.error("Quantidade deve ser maior que zero");return}if(g<=0){u.error("Preço unitário deve ser maior que zero");return}try{const $={...n,product_id:n.item_type==="product"&&n.product_id?parseInt(n.product_id):null,labor_id:n.item_type==="labor"&&n.labor_id?parseInt(n.labor_id):null,quantity:a,unit_price:g};await _.post(`/orders/${b.id}/items`,$),u.success("Item adicionado com sucesso!"),De(),await ge(b.id);const J=await _.get(`/orders/${b.id}`);ee(J.data),s(),ue(),l()}catch($){u.error(((R=(j=$.response)==null?void 0:j.data)==null?void 0:R.error)||"Erro ao adicionar item")}},I=async t=>{var g,j;if(!b)return;const a=P.find(R=>R.id===t);if(a&&confirm(`Tem certeza que deseja remover "${a.description}" da OS?`))try{await _.delete(`/orders/${b.id}/items/${t}`),u.success("Item removido com sucesso!"),await ge(b.id);const R=await _.get(`/orders/${b.id}`);ee(R.data),s(),ue(),l()}catch(R){u.error(((j=(g=R.response)==null?void 0:g.data)==null?void 0:j.error)||"Erro ao remover item")}},te=async t=>{var a;Ee(t),r({client_id:t.client_id.toString(),vehicle_id:t.vehicle_id.toString(),mechanic_id:((a=t.mechanic_id)==null?void 0:a.toString())||"",status:t.status,discount:t.discount.toString(),technical_notes:t.technical_notes||"",template_id:""}),Fe(t.client_id),A(!0)},re=async t=>{ee(t),await ge(t.id),Ce(!0)},Ne=t=>{Be(t),we(!0)},Ze=async(t,a)=>{var g,j;try{K(t);const R=await _.post(`/orders/${t}/quick-action`,{action:a});u.success("Status atualizado com sucesso!"),s(),l(),(b==null?void 0:b.id)===t&&ee(R.data)}catch(R){u.error(((j=(g=R.response)==null?void 0:g.data)==null?void 0:j.error)||"Erro ao executar ação")}finally{K(null)}},et=async t=>{var a,g;try{K(t);const j=await _.post(`/orders/${t}/assume`);u.success("OS assumida com sucesso!"),s(),l(),(b==null?void 0:b.id)===t&&ee(j.data)}catch(j){u.error(((g=(a=j.response)==null?void 0:a.data)==null?void 0:g.error)||"Erro ao assumir ordem de serviço")}finally{K(null)}},tt=t=>{We(t),ce(!0)},St=()=>{s(),l(),b&&se&&b.id===se.id&&Ne(b.id)},rt=async t=>{var a,g,j,R,$;if(confirm(`Tem certeza que deseja excluir esta ordem de serviço?

Esta ação não pode ser desfeita e irá excluir todos os itens, histórico e arquivos vinculados.`))try{u.loading("Excluindo ordem de serviço...",{id:"delete-order"}),await _.delete(`/orders/${t}`),u.success("Ordem de serviço excluída com sucesso!",{id:"delete-order"}),s(),l()}catch(J){const fe=((g=(a=J.response)==null?void 0:a.data)==null?void 0:g.error)||"Erro ao excluir ordem de serviço",Ve=(R=(j=J.response)==null?void 0:j.data)==null?void 0:R.unpaid_receivables;if(fe.includes("contas a receber")||fe.includes("em aberto")){const Rt=Ve?`

${Ve===1?"1 conta a receber":`${Ve} contas a receber`} precisa ser cancelada ou excluída.`:"";u.error(Wt=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{children:[fe,Rt]}),e.jsxs("button",{onClick:()=>{f("/financeiro?tab=receivables&order_id="+t),u.dismiss(Wt.id)},style:{marginTop:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",alignSelf:"flex-start"},children:[e.jsx(Lt,{size:14}),"Ir para Contas a Receber"]})]}),{id:"delete-order",duration:12e3})}else fe.includes("registros vinculados")||fe.includes("vinculados")?u.error(fe,{id:"delete-order",duration:8e3}):u.error(fe,{id:"delete-order"});console.error("Erro ao excluir ordem de serviço:",(($=J.response)==null?void 0:$.data)||J)}},ot=async(t,a)=>{var g,j;try{if(b&&a>b.subtotal){u.error(`O desconto não pode ser maior que o subtotal (${H(b.subtotal)})`);return}await _.put(`/orders/${t}/discount`,{discount:a}),u.success("Desconto atualizado com sucesso!"),s(),(b==null?void 0:b.id)===t&&ge(t)}catch(R){const $=((j=(g=R.response)==null?void 0:g.data)==null?void 0:j.error)||"Erro ao atualizar desconto";u.error($)}},Ae=()=>{r({client_id:"",vehicle_id:"",mechanic_id:"",status:"open",discount:"0",technical_notes:"",template_id:""}),Ee(null),x([])},De=()=>{o({item_type:"product",product_id:"",labor_id:"",description:"",quantity:"1",unit_price:"0"}),S(0),Se(null)},_t=t=>{var a,g;Se(t),o({item_type:t.item_type,product_id:((a=t.product_id)==null?void 0:a.toString())||"",labor_id:((g=t.labor_id)==null?void 0:g.toString())||"",description:t.description,quantity:t.quantity.toString(),unit_price:t.unit_price.toString()}),S(t.total_price)},H=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),zt=m.useMemo(()=>{if(!n.product_id)return null;const t=d.find(a=>a.id===parseInt(n.product_id));return t&&t.current_quantity<=0?e.jsxs("div",{style:{marginTop:"0.5rem",padding:"0.75rem",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#991b1b"},children:[e.jsx(je,{size:16}),"Este produto está sem estoque"]}):t&&parseFloat(n.quantity)>t.current_quantity?e.jsxs("div",{style:{marginTop:"0.5rem",padding:"0.75rem",backgroundColor:"#fef3c7",border:"1px solid #fde047",borderRadius:"6px",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#92400e"},children:[e.jsx(je,{size:16}),"Quantidade solicitada (",n.quantity,") excede estoque disponível (",t.current_quantity," ",t.unit,")"]}):null},[n.product_id,n.quantity,d]),le=m.useMemo(()=>{let t=i;if(W&&(t=t.filter(a=>a.status===W)),q){const a=q.toLowerCase();t=t.filter(g=>{var j,R,$,J;return g.order_number.toLowerCase().includes(a)||((j=g.client_name)==null?void 0:j.toLowerCase().includes(a))||((R=g.plate)==null?void 0:R.toLowerCase().includes(a))||(($=g.brand)==null?void 0:$.toLowerCase().includes(a))||((J=g.model)==null?void 0:J.toLowerCase().includes(a))})}return T.client_id&&(t=t.filter(a=>a.client_id===parseInt(T.client_id))),t},[i,T,W,q]),it=m.useMemo(()=>{const t=(he-1)*Z,a=t+Z;return le.slice(t,a)},[le,he,Z]),nt=Math.ceil(le.length/Z),st=t=>({open:"#64748b",in_progress:"#3b82f6",waiting_parts:"#f59e0b",finished:"#10b981",cancelled:"#ef4444"})[t]||"#64748b",at=t=>({open:"Aberta",in_progress:"Em Andamento",waiting_parts:"Aguardando Peças",finished:"Finalizada",cancelled:"Cancelada"})[t]||t,kt=t=>{const a=d.find(g=>g.id===parseInt(t));if(a){const g=a.sale_price.toString(),j=parseFloat(n.quantity)||1,R=a.sale_price*j;o({...n,product_id:t,description:a.name,unit_price:g}),S(R)}else o({...n,product_id:t,description:"",unit_price:"0"}),S(0)},wt=t=>{const a=F.find(g=>g.id===parseInt(t));if(a){const g=a.price.toString(),j=parseFloat(n.quantity)||1,R=a.price*j;o({...n,labor_id:t,description:a.name,unit_price:g}),S(R)}else o({...n,labor_id:t,description:"",unit_price:"0"}),S(0)};return m.useEffect(()=>{const t=parseFloat(n.quantity)||0,a=parseFloat(n.unit_price)||0;S(t*a)},[n.quantity,n.unit_price]),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"1.875rem",fontWeight:"bold",color:"#1e293b",marginBottom:"0.5rem"},children:"Ordens de Serviço"}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Gerencie as ordens de serviço da oficina"})]}),e.jsxs("button",{onClick:()=>{Ae(),A(!0)},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[e.jsx(bt,{size:20}),"Nova OS"]})]}),G&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsx("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{padding:"0.5rem",backgroundColor:"#3b82f620",borderRadius:"8px"},children:e.jsx(ye,{size:20,color:"#3b82f6"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Total de OS"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1e293b"},children:G.total})]})]})}),e.jsx("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{padding:"0.5rem",backgroundColor:"#10b98220",borderRadius:"8px"},children:e.jsx(ke,{size:20,color:"#10b981"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Finalizadas"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1e293b"},children:((lt=G.byStatus)==null?void 0:lt.finished)||0})]})]})}),e.jsx("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{padding:"0.5rem",backgroundColor:"#f59e0b20",borderRadius:"8px"},children:e.jsx(Xe,{size:20,color:"#f59e0b"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Em Andamento"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1e293b"},children:(((dt=G.byStatus)==null?void 0:dt.in_progress)||0)+(((ct=G.byStatus)==null?void 0:ct.waiting_parts)||0)+(((mt=G.byStatus)==null?void 0:mt.open)||0)})]})]})}),e.jsx("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{padding:"0.5rem",backgroundColor:"#10b98220",borderRadius:"8px"},children:e.jsx(xt,{size:20,color:"#10b981"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Total Finalizado"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1e293b"},children:H(((pt=G.values)==null?void 0:pt.finished)||0)})]})]})})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("div",{style:{position:"relative",maxWidth:"500px"},children:[e.jsx(Pt,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#64748b"}}),e.jsx("input",{type:"text",placeholder:"Buscar por número, cliente ou placa...",value:q,onChange:t=>E(t.target.value),style:{width:"100%",padding:"0.75rem 1rem 0.75rem 2.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",outline:"none"}})]})}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.75rem",fontWeight:"500"},children:"Filtrar por Status:"}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:[e.jsx(be,{status:"open",onClick:()=>Y(W==="open"?"":"open"),active:W==="open"}),e.jsx(be,{status:"in_progress",onClick:()=>Y(W==="in_progress"?"":"in_progress"),active:W==="in_progress"}),e.jsx(be,{status:"waiting_parts",onClick:()=>Y(W==="waiting_parts"?"":"waiting_parts"),active:W==="waiting_parts"}),e.jsx(be,{status:"finished",onClick:()=>Y(W==="finished"?"":"finished"),active:W==="finished"}),e.jsx(be,{status:"cancelled",onClick:()=>Y(W==="cancelled"?"":"cancelled"),active:W==="cancelled"}),W&&e.jsx("button",{onClick:()=>Y(""),style:{padding:"0.5rem 1rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"600",cursor:"pointer"},children:"Limpar Filtro"})]})]}),e.jsx($t,{filters:{client_id:{label:"Cliente",type:"select",options:z.map(t=>({label:t.name,value:t.id.toString()}))},date_from:{label:"Data Inicial",type:"date"},date_to:{label:"Data Final",type:"date"}},onFilterChange:X})]}),C?e.jsx("div",{style:{display:"grid",gridTemplateColumns:D?"1fr":"repeat(auto-fill, minmax(350px, 1fr))",gap:"1rem"},children:Array.from({length:6}).map((t,a)=>e.jsx(Mt,{type:"card"},a))}):le.length===0?e.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b",backgroundColor:"white",borderRadius:"12px"},children:[e.jsx(ye,{size:48,color:"#cbd5e1",style:{margin:"0 auto 1rem"}}),e.jsx("p",{style:{fontSize:"1rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Nenhuma ordem de serviço encontrada"}),e.jsx("p",{style:{fontSize:"0.875rem"},children:"Tente ajustar os filtros ou criar uma nova OS"})]}):D?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:it.map(t=>e.jsx(Ut,{order:t,onEdit:te,onDelete:rt,onView:Ne,onViewItems:re,onQuickAction:Ze,onAssume:et,onTransfer:tt,currentUserId:h==null?void 0:h.id,currentUserProfile:h==null?void 0:h.profile,formatCurrency:H,getStatusLabel:at,loading:de===t.id},t.id))}):e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Número"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Cliente / Veículo"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Mecânico"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Status"}),e.jsx("th",{style:{padding:"1rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Total"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Ações"})]})}),e.jsx("tbody",{children:it.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",transition:"background-color 0.2s"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="white"},children:[e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"8px",backgroundColor:"#f97316",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ye,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:"#1e293b"},children:t.order_number}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:new Date(t.created_at).toLocaleDateString("pt-BR")})]})]})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:"#1e293b",marginBottom:"0.25rem"},children:t.client_name}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(He,{size:14}),t.brand," ",t.model," ",t.plate&&`- ${t.plate}`]})]})}),e.jsx("td",{style:{padding:"1rem",color:"#64748b",fontSize:"0.875rem"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("div",{children:t.mechanic_name||e.jsx("span",{style:{color:"#94a3b8",fontStyle:"italic"},children:"Sem mecânico"})}),((h==null?void 0:h.profile)==="admin"||(h==null?void 0:h.profile)==="mechanic"||(h==null?void 0:h.profile)==="attendant")&&t.status!=="finished"&&t.status!=="cancelled"&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[(!t.mechanic_id||t.mechanic_id!==(h==null?void 0:h.id))&&((h==null?void 0:h.profile)==="admin"||(h==null?void 0:h.profile)==="mechanic")&&e.jsxs("button",{onClick:()=>et(t.id),disabled:de===t.id,style:{padding:"0.375rem 0.75rem",backgroundColor:"#e0e7ff",border:"none",borderRadius:"6px",cursor:de===t.id?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500",color:"#6366f1",opacity:de===t.id?.5:1},title:"Assumir OS",children:[e.jsx(jt,{size:14}),"Assumir"]}),e.jsxs("button",{onClick:()=>tt(t),style:{padding:"0.375rem 0.75rem",backgroundColor:"#fef3c7",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500",color:"#f59e0b"},title:"Transferir OS",children:[e.jsx(vt,{size:14}),"Transferir"]})]})]})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:st(t.status)+"20",color:st(t.status)},children:at(t.status)})}),e.jsx("td",{style:{padding:"1rem",textAlign:"right",fontWeight:"600",color:"#1e293b"},children:H(t.total)}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{onClick:()=>Ne(t.id),style:{padding:"0.5rem",backgroundColor:"#eff6ff",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Ver Detalhes",children:e.jsx(yt,{size:16,color:"#3b82f6"})}),e.jsx("button",{onClick:()=>re(t),style:{padding:"0.5rem",backgroundColor:"#f0fdf4",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Ver/Adicionar Itens",children:e.jsx(Qe,{size:16,color:"#10b981"})}),e.jsx("button",{onClick:()=>te(t),style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Editar",children:e.jsx(Ye,{size:16,color:"#64748b"})}),e.jsx("button",{onClick:()=>rt(t.id),style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Excluir",children:e.jsx(Pe,{size:16,color:"#ef4444"})}),e.jsx(Ct,{order:t,onAction:Ze,loading:de===t.id})]})})]},t.id))})]}),!C&&le.length>0&&e.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #e2e8f0"},children:e.jsx(ht,{currentPage:he,totalPages:nt,onPageChange:ie,totalItems:le.length,itemsPerPage:Z})})]}),!C&&le.length>0&&D&&e.jsx("div",{style:{marginTop:"1rem"},children:e.jsx(ht,{currentPage:he,totalPages:nt,onPageChange:ie,totalItems:le.length,itemsPerPage:Z})}),xe&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>{A(!1),Ae()},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"600px",maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{style:{marginBottom:"1.5rem",fontSize:"1.5rem",fontWeight:"bold"},children:ae?"Editar Ordem de Serviço":"Nova Ordem de Serviço"}),e.jsxs("form",{onSubmit:Je,children:[!ae&&k.length>0&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"1rem",backgroundColor:"#eff6ff",borderRadius:"8px",border:"1px solid #bfdbfe"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600",color:"#1e40af"},children:"Aplicar Template (Opcional)"}),e.jsxs("select",{value:w.template_id,onChange:t=>r({...w,template_id:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #93c5fd",borderRadius:"8px",fontSize:"0.9rem",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Nenhum template"}),k.map(t=>{var a;return e.jsxs("option",{value:t.id,children:[t.name," ",t.description&&`- ${t.description}`," (",((a=t.items)==null?void 0:a.length)||0," itens)"]},t.id)})]}),w.template_id&&e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"#1e40af"},children:e.jsx("strong",{children:"Os itens do template serão adicionados automaticamente após criar a OS."})})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Cliente *"}),e.jsxs("select",{value:w.client_id,onChange:t=>{r({...w,client_id:t.target.value,vehicle_id:""}),t.target.value&&Fe(parseInt(t.target.value))},required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"",children:"Selecione um cliente"}),z.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Veículo *"}),e.jsxs("select",{value:w.vehicle_id,onChange:t=>r({...w,vehicle_id:t.target.value}),required:!0,disabled:!w.client_id,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",opacity:w.client_id?1:.6},children:[e.jsx("option",{value:"",children:"Selecione um veículo"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.brand," ",t.model," ",t.plate&&`- ${t.plate}`]},t.id))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Status"}),e.jsxs("select",{value:w.status,onChange:t=>r({...w,status:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"open",children:"Aberta"}),e.jsx("option",{value:"in_progress",children:"Em Andamento"}),e.jsx("option",{value:"waiting_parts",children:"Aguardando Peças"}),e.jsx("option",{value:"finished",children:"Finalizada"}),e.jsx("option",{value:"cancelled",children:"Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Desconto (R$)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:w.discount,onChange:t=>r({...w,discount:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Observações Técnicas"}),e.jsx("textarea",{value:w.technical_notes,onChange:t=>r({...w,technical_notes:t.target.value}),rows:4,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",resize:"vertical"}})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{A(!1),Ae()},style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:ae?"Atualizar":"Criar"})]})]})]})}),ne&&b&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},onClick:()=>{Ce(!1),ee(null),pe([]),De()},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"900px",maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"0.5rem"},children:["Itens da OS: ",b.order_number]}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:[b.client_name," - ",b.brand," ",b.model]})]}),e.jsx("button",{onClick:()=>{Ce(!1),ee(null),pe([])},style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer"},children:e.jsx(qe,{size:20,color:"#64748b"})})]}),e.jsxs("div",{style:{marginBottom:"2rem",padding:"1.5rem",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600",color:"#1e293b"},children:L?"Editar Item":"Adicionar Item"}),e.jsxs("div",{style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"600"},children:["Total: ",H(c)]})]}),e.jsxs("form",{onSubmit:$e,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Tipo *"}),e.jsxs("select",{value:n.item_type,onChange:t=>{o({...n,item_type:t.target.value,product_id:"",labor_id:"",description:"",unit_price:"0",quantity:"1"}),S(0)},required:!0,disabled:!!L,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",backgroundColor:L?"#f8fafc":"white"},children:[e.jsx("option",{value:"product",children:"Produto"}),e.jsx("option",{value:"labor",children:"Mão de Obra"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:n.item_type==="product"?"Produto *":"Mão de Obra *"}),n.item_type==="product"?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:n.product_id,onChange:t=>kt(t.target.value),required:!0,disabled:!!L,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",backgroundColor:L?"#f8fafc":"white"},children:[e.jsx("option",{value:"",children:"Selecione um produto"}),d.filter(t=>t.current_quantity>0).map(t=>e.jsxs("option",{value:t.id,children:[t.name," - Estoque: ",t.current_quantity," ",t.unit," - ",H(t.sale_price)]},t.id)),d.filter(t=>t.current_quantity<=0).length>0&&e.jsx("optgroup",{label:"⚠️ Produtos sem estoque",style:{color:"#ef4444",fontStyle:"italic"},children:d.filter(t=>t.current_quantity<=0).map(t=>e.jsxs("option",{value:t.id,disabled:!0,style:{color:"#ef4444"},children:[t.name," - Sem estoque - ",H(t.sale_price)]},t.id))})]}),zt]}):e.jsxs("select",{value:n.labor_id,onChange:t=>wt(t.target.value),required:!0,disabled:!!L,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",backgroundColor:L?"#f8fafc":"white"},children:[e.jsx("option",{value:"",children:"Selecione um serviço"}),F.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",H(t.price)]},t.id))]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Descrição *"}),e.jsx("input",{type:"text",value:n.description,onChange:t=>o({...n,description:t.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:n.quantity,onChange:t=>{const a=t.target.value;o({...n,quantity:a})},required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Preço Unit. *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.unit_price,onChange:t=>{const a=t.target.value;o({...n,unit_price:a})},required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.75rem",color:"#64748b",fontWeight:"500"},children:"Total do Item"}),e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",fontSize:"1rem",fontWeight:"bold",color:"#10b981",textAlign:"center"},children:H(c)})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-end"},children:[e.jsx("button",{type:"submit",disabled:!n.description||c<=0,style:{width:"100%",padding:"0.75rem",backgroundColor:!n.description||c<=0?"#cbd5e1":L?"#3b82f6":"#10b981",color:"white",border:"none",borderRadius:"8px",cursor:!n.description||c<=0?"not-allowed":"pointer",fontWeight:"600",transition:"background-color 0.2s"},children:L?"Salvar Alterações":"Adicionar"}),L&&e.jsx("button",{type:"button",onClick:()=>De(),style:{width:"100%",marginTop:"0.5rem",padding:"0.75rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar Edição"})]})]})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600"},children:"Itens Adicionados"}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b",fontWeight:"500"},children:[P.length," ",P.length===1?"item":"itens"]})]}),P.length===0?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b",backgroundColor:"#f8fafc",borderRadius:"8px"},children:"Nenhum item adicionado. Use o formulário acima para adicionar produtos ou serviços."}):e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"8px",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Item"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Qtd"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Unit."}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Total"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b",width:"80px"},children:"Ação"})]})}),e.jsx("tbody",{children:P.map((t,a)=>e.jsxs("tr",{style:{borderBottom:a<P.length-1?"1px solid #e2e8f0":"none",backgroundColor:"white",transition:"background-color 0.2s"},onMouseEnter:g=>{g.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:g=>{g.currentTarget.style.backgroundColor="white"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.item_type==="product"?e.jsx(Qe,{size:16,color:"#3b82f6"}):e.jsx(ze,{size:16,color:"#f97316"}),e.jsx("span",{style:{fontWeight:"600",color:"#1e293b"},children:t.description})]})}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",color:"#64748b"},children:t.quantity.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",color:"#64748b"},children:H(t.unit_price)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600",color:"#1e293b"},children:H(t.total_price)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>_t(t),style:{padding:"0.5rem",backgroundColor:"#dbeafe",border:"none",borderRadius:"6px",cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:g=>{g.currentTarget.style.backgroundColor="#bfdbfe"},onMouseLeave:g=>{g.currentTarget.style.backgroundColor="#dbeafe"},title:"Editar item",children:e.jsx(Ye,{size:16,color:"#3b82f6"})}),e.jsx("button",{onClick:()=>I(t.id),style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:g=>{g.currentTarget.style.backgroundColor="#fecaca"},onMouseLeave:g=>{g.currentTarget.style.backgroundColor="#fee2e2"},title:"Remover item",children:e.jsx(Pe,{size:16,color:"#ef4444"})})]})})]},t.id))})]})})]}),e.jsxs("div",{style:{padding:"1.5rem",backgroundColor:"#f8fafc",borderRadius:"8px",marginBottom:"1rem",border:"1px solid #e2e8f0"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"1rem",color:"#1e293b"},children:"Resumo Financeiro"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.75rem",alignItems:"center"},children:[e.jsxs("span",{style:{color:"#64748b",fontSize:"0.9rem"},children:["Subtotal (",P.length," ",P.length===1?"item":"itens","):"]}),e.jsx("span",{style:{fontWeight:"600",fontSize:"1rem",color:"#1e293b"},children:H(b.subtotal)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.75rem",alignItems:"center"},children:[e.jsx("span",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Desconto:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.75rem",color:"#64748b"},children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:b.subtotal,value:b.discount,onChange:t=>{const a=parseFloat(t.target.value)||0;a<=b.subtotal&&ot(b.id,a)},style:{width:"120px",padding:"0.5rem",border:b.discount>b.subtotal?"2px solid #ef4444":"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",textAlign:"right"}}),b.discount>0&&e.jsxs("button",{onClick:()=>ot(b.id,0),style:{padding:"0.25rem 0.5rem",backgroundColor:"#fee2e2",color:"#ef4444",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Remover desconto",children:[e.jsx(qe,{size:12}),"Limpar"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"1rem",borderTop:"2px solid #e2e8f0",marginTop:"0.5rem",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"600",fontSize:"1.1rem",color:"#1e293b"},children:"Total:"}),e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.5rem",color:"#10b981"},children:H(b.total)})]})]})]})}),oe&&e.jsx(Vt,{orderId:Ie,onClose:()=>{we(!1),Be(null)},onUpdate:()=>{s(),l()}}),Re&&se&&e.jsx(Qt,{orderId:se.id,orderNumber:se.order_number,currentMechanicName:se.mechanic_name,onClose:()=>{ce(!1),We(null)},onSuccess:St})]})};export{er as default};
