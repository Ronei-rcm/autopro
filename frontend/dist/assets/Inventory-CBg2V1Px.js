import{a as u,j as e}from"./index-DNHKrThd.js";import{r as n}from"./react-vendor-BpgKpUzx.js";import{z as d,I as K,g as O,G as S,P as V,t as X,O as Y,Q as H,Z}from"./ui-vendor-yLLZ9URH.js";import{S as J}from"./SkeletonLoader-DMsGFzU7.js";import"./pdf-vendor-BOaogWDS.js";const ne=()=>{const[C,W]=n.useState([]),[B,R]=n.useState([]),[z,E]=n.useState([]),[P,k]=n.useState(!0),[h,I]=n.useState(""),[y,A]=n.useState(""),[m,M]=n.useState(!1),[T,p]=n.useState(!1),[F,f]=n.useState(!1),[g,q]=n.useState(null),[a,b]=n.useState(null),[r,s]=n.useState({code:"",name:"",description:"",category:"",supplier_id:"",cost_price:"0",sale_price:"0",min_quantity:"0",current_quantity:"0",unit:"UN",active:!0}),[o,x]=n.useState({quantity:"",type:"adjustment",notes:""});n.useEffect(()=>{j(),N(),_()},[h,y,m]);const j=async()=>{try{k(!0);const t={};h&&(t.search=h),y&&(t.category=y),m&&(t.low_stock="true");const i=await u.get("/products",{params:t});W(i.data)}catch(t){d.error("Erro ao carregar produtos"),console.error(t)}finally{k(!1)}},N=async()=>{try{const t=await u.get("/suppliers");R(t.data)}catch(t){console.error("Erro ao carregar fornecedores:",t)}},_=async()=>{try{const t=await u.get("/products/categories");E(t.data)}catch(t){console.error("Erro ao carregar categorias:",t)}},D=async t=>{var i,c;t.preventDefault();try{const l={...r,code:r.code||null,supplier_id:r.supplier_id?parseInt(r.supplier_id):null,cost_price:parseFloat(r.cost_price),sale_price:parseFloat(r.sale_price),min_quantity:parseInt(r.min_quantity)||0,current_quantity:parseInt(r.current_quantity)||0,category:r.category||null,description:r.description||null};g?(await u.put(`/products/${g.id}`,l),d.success("Produto atualizado com sucesso!")):(await u.post("/products",l),d.success("Produto criado com sucesso!")),p(!1),v(),j(),_()}catch(l){d.error(((c=(i=l.response)==null?void 0:i.data)==null?void 0:c.error)||"Erro ao salvar produto")}},L=async t=>{var i,c;if(t.preventDefault(),!!a)try{await u.post(`/products/${a.id}/adjust-stock`,{quantity:parseFloat(o.quantity),type:o.type,notes:o.notes}),d.success("Estoque ajustado com sucesso!"),f(!1),x({quantity:"",type:"adjustment",notes:""}),b(null),j()}catch(l){d.error(((c=(i=l.response)==null?void 0:i.data)==null?void 0:c.error)||"Erro ao ajustar estoque")}},U=t=>{var i;q(t),s({code:t.code||"",name:t.name,description:t.description||"",category:t.category||"",supplier_id:((i=t.supplier_id)==null?void 0:i.toString())||"",cost_price:t.cost_price.toString(),sale_price:t.sale_price.toString(),min_quantity:t.min_quantity.toString(),current_quantity:t.current_quantity.toString(),unit:t.unit,active:t.active}),p(!0)},Q=async t=>{if(confirm("Tem certeza que deseja excluir este produto?"))try{await u.delete(`/products/${t}`),d.success("Produto excluído com sucesso!"),j()}catch{d.error("Erro ao excluir produto")}},G=t=>{b(t),x({quantity:"",type:"adjustment",notes:""}),f(!0)},v=()=>{s({code:"",name:"",description:"",category:"",supplier_id:"",cost_price:"0",sale_price:"0",min_quantity:"0",current_quantity:"0",unit:"UN",active:!0}),q(null)},w=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),$=t=>t.current_quantity<=0?{color:"#ef4444",text:"Sem estoque",icon:S}:t.current_quantity<=t.min_quantity?{color:"#f59e0b",text:"Estoque baixo",icon:S}:{color:"#10b981",text:"Normal",icon:Z};return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"1.875rem",fontWeight:"bold",color:"#1e293b",marginBottom:"0.5rem"},children:"Estoque"}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Controle de produtos e peças"})]}),e.jsxs("button",{onClick:()=>{v(),p(!0)},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[e.jsx(K,{size:20}),"Novo Produto"]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:"250px",maxWidth:"400px"},children:[e.jsx(O,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#64748b"}}),e.jsx("input",{type:"text",placeholder:"Buscar por nome, código ou descrição...",value:h,onChange:t=>I(t.target.value),style:{width:"100%",padding:"0.75rem 1rem 0.75rem 2.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",outline:"none"}})]}),e.jsxs("select",{value:y,onChange:t=>A(t.target.value),style:{padding:"0.75rem 1rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"Todas as categorias"}),z.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("button",{onClick:()=>M(!m),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:m?"#fee2e2":"#f1f5f9",color:m?"#ef4444":"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[e.jsx(S,{size:18}),"Estoque Baixo"]})]}),e.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",overflow:"hidden"},children:P?e.jsx(J,{type:"table"}):C.length===0?e.jsx("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Nenhum produto encontrado"}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Produto"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Categoria"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Fornecedor"}),e.jsx("th",{style:{padding:"1rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Estoque"}),e.jsx("th",{style:{padding:"1rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Preços"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Ações"})]})}),e.jsx("tbody",{children:C.map(t=>{const i=$(t),c=i.icon;return e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",transition:"background-color 0.2s"},onMouseEnter:l=>{l.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:l=>{l.currentTarget.style.backgroundColor="white"},children:[e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"8px",backgroundColor:"#f97316",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(V,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:"#1e293b"},children:t.name}),t.code&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:["Código: ",t.code]})]})]})}),e.jsx("td",{style:{padding:"1rem",color:"#64748b",fontSize:"0.875rem"},children:t.category||"-"}),e.jsx("td",{style:{padding:"1rem",color:"#64748b",fontSize:"0.875rem"},children:t.supplier_name||"-"}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.25rem"},children:[e.jsxs("div",{style:{fontWeight:"600",color:"#1e293b"},children:[t.current_quantity," ",t.unit]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:i.color},children:[e.jsx(c,{size:12}),i.text]}),t.min_quantity>0&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:["Mín: ",t.min_quantity]})]})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.25rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{color:"#64748b"},children:["Custo: ",w(t.cost_price)]}),e.jsxs("div",{style:{fontWeight:"600",color:"#10b981"},children:["Venda: ",w(t.sale_price)]})]})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>G(t),style:{padding:"0.5rem",backgroundColor:"#f0fdf4",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Ajustar estoque",children:e.jsx(X,{size:16,color:"#10b981"})}),e.jsx("button",{onClick:()=>U(t),style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Editar",children:e.jsx(Y,{size:16,color:"#64748b"})}),e.jsx("button",{onClick:()=>Q(t.id),style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Excluir",children:e.jsx(H,{size:16,color:"#ef4444"})})]})})]},t.id)})})]})}),T&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>{p(!1),v()},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"700px",maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{style:{marginBottom:"1.5rem",fontSize:"1.5rem",fontWeight:"bold"},children:g?"Editar Produto":"Novo Produto"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Código"}),e.jsx("input",{type:"text",value:r.code,onChange:t=>s({...r,code:t.target.value}),placeholder:"Código interno",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Nome *"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>s({...r,name:t.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Categoria"}),e.jsx("input",{type:"text",value:r.category,onChange:t=>s({...r,category:t.target.value}),placeholder:"Ex: Peças, Óleos, Filtros",list:"categories",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}}),e.jsx("datalist",{id:"categories",children:z.map(t=>e.jsx("option",{value:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Fornecedor"}),e.jsxs("select",{value:r.supplier_id,onChange:t=>s({...r,supplier_id:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"",children:"Selecione um fornecedor"}),B.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Descrição"}),e.jsx("textarea",{value:r.description,onChange:t=>s({...r,description:t.target.value}),rows:2,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Preço de Custo *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.cost_price,onChange:t=>s({...r,cost_price:t.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Preço de Venda *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.sale_price,onChange:t=>s({...r,sale_price:t.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Qtd. Mínima"}),e.jsx("input",{type:"number",min:"0",value:r.min_quantity,onChange:t=>s({...r,min_quantity:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Unidade"}),e.jsxs("select",{value:r.unit,onChange:t=>s({...r,unit:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"UN",children:"UN - Unidade"}),e.jsx("option",{value:"KG",children:"KG - Quilograma"}),e.jsx("option",{value:"L",children:"L - Litro"}),e.jsx("option",{value:"M",children:"M - Metro"}),e.jsx("option",{value:"CX",children:"CX - Caixa"})]})]})]}),!g&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Quantidade Inicial"}),e.jsx("input",{type:"number",min:"0",value:r.current_quantity,onChange:t=>s({...r,current_quantity:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{p(!1),v()},style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:g?"Atualizar":"Criar"})]})]})]})}),F&&a&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},onClick:()=>{f(!1),b(null)},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"500px"},onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{style:{marginBottom:"1rem",fontSize:"1.5rem",fontWeight:"bold"},children:"Ajustar Estoque"}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem"},children:"Produto"}),e.jsx("div",{style:{fontWeight:"600",color:"#1e293b"},children:a.name}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b",marginTop:"0.5rem"},children:["Estoque atual: ",e.jsxs("strong",{children:[a.current_quantity," ",a.unit]})]})]}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Tipo de Movimentação *"}),e.jsxs("select",{value:o.type,onChange:t=>x({...o,type:t.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"entry",children:"Entrada (Adicionar)"}),e.jsx("option",{value:"exit",children:"Saída (Remover)"}),e.jsx("option",{value:"adjustment",children:"Ajuste (Definir quantidade)"})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:o.quantity,onChange:t=>x({...o,quantity:t.target.value}),required:!0,placeholder:"0.00",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}}),o.type==="entry"&&e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"#10b981"},children:["Novo estoque: ",a.current_quantity+parseFloat(o.quantity||"0")," ",a.unit]}),o.type==="exit"&&e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"#f59e0b"},children:["Novo estoque: ",Math.max(0,a.current_quantity-parseFloat(o.quantity||"0"))," ",a.unit]}),o.type==="adjustment"&&e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"#64748b"},children:["Estoque será definido como: ",o.quantity||"0"," ",a.unit]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Observações"}),e.jsx("textarea",{value:o.notes,onChange:t=>x({...o,notes:t.target.value}),rows:3,placeholder:"Motivo da movimentação...",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",resize:"vertical"}})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),b(null)},style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Confirmar"})]})]})]})})]})};export{ne as default};
