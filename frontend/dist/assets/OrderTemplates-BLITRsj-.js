import{a as m,j as e}from"./index-DNHKrThd.js";import{r as n}from"./react-vendor-BpgKpUzx.js";import{z as l,I as B,g as K,F as V,O as Z,Q as ee,P as te,W as re,X as oe}from"./ui-vendor-yLLZ9URH.js";import{S as ie}from"./SkeletonLoader-DMsGFzU7.js";import{P as ne}from"./Pagination-MtMwbbp0.js";import{C as se}from"./ConfirmDialog-DmvZqo8B.js";import"./pdf-vendor-BOaogWDS.js";const ge=()=>{var R;const[z,I]=n.useState([]),[_,A]=n.useState([]),[w,P]=n.useState([]),[k,T]=n.useState(!0),[u,E]=n.useState(""),[S,q]=n.useState(1),[g]=n.useState(10),[L,h]=n.useState(!1),[x,W]=n.useState(null),[f,y]=n.useState({isOpen:!1,template:null}),[s,d]=n.useState({name:"",description:"",category:"",active:!0}),[c,b]=n.useState([]),[r,a]=n.useState({item_type:"product",product_id:"",labor_id:"",description:"",quantity:"1",unit_price:"0"});n.useEffect(()=>{C(),D(),F()},[u]);const C=async()=>{try{T(!0);const t=await m.get("/order-templates");I(t.data)}catch(t){l.error("Erro ao carregar templates"),console.error(t)}finally{T(!1)}},D=async()=>{try{const t=await m.get("/products");A(t.data)}catch(t){console.error("Erro ao carregar produtos:",t)}},F=async()=>{try{const t=await m.get("/labor-types",{params:{active:"true"}});P(t.data)}catch(t){console.error("Erro ao carregar tipos de mão de obra:",t)}},j=()=>{d({name:"",description:"",category:"",active:!0}),b([]),a({item_type:"product",product_id:"",labor_id:"",description:"",quantity:"1",unit_price:"0"}),W(null)},O=async t=>{var o,i;t.preventDefault();try{const v={...s,items:c};x?(await m.put(`/order-templates/${x.id}`,v),l.success("Template atualizado com sucesso!")):(await m.post("/order-templates",v),l.success("Template criado com sucesso!")),h(!1),j(),C()}catch(v){l.error(((i=(o=v.response)==null?void 0:o.data)==null?void 0:i.error)||"Erro ao salvar template")}},N=t=>{var o;W(t),d({name:t.name,description:t.description||"",category:t.category||"",active:t.active}),b(((o=t.items)==null?void 0:o.map(i=>({product_id:i.product_id,labor_id:i.labor_id,description:i.description,quantity:i.quantity,unit_price:i.unit_price,item_type:i.item_type})))||[]),h(!0)},M=t=>{y({isOpen:!0,template:t})},Q=async()=>{if(f.template)try{await m.delete(`/order-templates/${f.template.id}`),l.success("Template excluído com sucesso!"),y({isOpen:!1,template:null}),C()}catch{l.error("Erro ao excluir template"),y({isOpen:!1,template:null})}},$=()=>{if(!r.description.trim()){l.error("Descrição é obrigatória");return}const t=parseFloat(r.quantity),o=parseFloat(r.unit_price);if(t<=0){l.error("Quantidade deve ser maior que zero");return}if(o<=0){l.error("Preço unitário deve ser maior que zero");return}const i={item_type:r.item_type,product_id:r.item_type==="product"&&r.product_id?parseInt(r.product_id):void 0,labor_id:r.item_type==="labor"&&r.labor_id?parseInt(r.labor_id):void 0,description:r.description,quantity:t,unit_price:o};b([...c,i]),a({item_type:"product",product_id:"",labor_id:"",description:"",quantity:"1",unit_price:"0"})},U=t=>{b(c.filter((o,i)=>i!==t))},Y=t=>{a({...r,item_type:t,product_id:"",labor_id:"",description:"",unit_price:"0"})},G=t=>{const o=_.find(i=>i.id===parseInt(t));o&&a({...r,product_id:t,description:o.name,unit_price:o.sale_price.toString()})},H=t=>{const o=w.find(i=>i.id===parseInt(t));o&&a({...r,labor_id:t,description:o.name,unit_price:o.price.toString()})},p=n.useMemo(()=>z.filter(t=>{if(u){const o=u.toLowerCase();return t.name.toLowerCase().includes(o)||t.description&&t.description.toLowerCase().includes(o)||t.category&&t.category.toLowerCase().includes(o)}return!0}),[z,u]),X=n.useMemo(()=>{const t=(S-1)*g;return p.slice(t,t+g)},[p,S,g]),J=Math.ceil(p.length/g);return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"1.875rem",fontWeight:"bold",color:"#1e293b",marginBottom:"0.5rem"},children:"Templates de OS"}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Gerencie templates para criar ordens de serviço rapidamente"})]}),e.jsxs("button",{onClick:()=>{j(),h(!0)},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[e.jsx(B,{size:20}),"Novo Template"]})]}),e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{position:"relative",maxWidth:"400px"},children:[e.jsx(K,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#64748b"}}),e.jsx("input",{type:"text",placeholder:"Buscar templates...",value:u,onChange:t=>E(t.target.value),style:{width:"100%",padding:"0.75rem 1rem 0.75rem 2.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",outline:"none"}})]})}),e.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",overflow:"hidden"},children:k?e.jsx(ie,{type:"table"}):p.length===0?e.jsx("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Nenhum template encontrado"}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Nome"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Descrição"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Categoria"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Itens"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Status"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Ações"})]})}),e.jsx("tbody",{children:X.map(t=>{var o;return e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",transition:"background-color 0.2s"},onMouseEnter:i=>{i.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:i=>{i.currentTarget.style.backgroundColor="white"},children:[e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(V,{size:20,color:"#f97316"}),e.jsx("span",{style:{fontWeight:"600",color:"#1e293b"},children:t.name})]})}),e.jsx("td",{style:{padding:"1rem",color:"#64748b",fontSize:"0.875rem"},children:t.description||"-"}),e.jsx("td",{style:{padding:"1rem",color:"#64748b",fontSize:"0.875rem"},children:t.category||"-"}),e.jsx("td",{style:{padding:"1rem",textAlign:"center",color:"#64748b",fontSize:"0.875rem"},children:((o=t.items)==null?void 0:o.length)||0}),e.jsx("td",{style:{padding:"1rem",textAlign:"center"},children:e.jsx("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"12px",fontWeight:"600",backgroundColor:t.active?"#10b98120":"#64748b20",color:t.active?"#10b981":"#64748b"},children:t.active?"Ativo":"Inativo"})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>N(t),style:{padding:"0.5rem",backgroundColor:"#f1f5f9",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Editar",children:e.jsx(Z,{size:16,color:"#64748b"})}),e.jsx("button",{onClick:()=>M(t),style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Excluir",children:e.jsx(ee,{size:16,color:"#ef4444"})})]})})]},t.id)})})]})}),!k&&p.length>0&&e.jsx(ne,{currentPage:S,totalPages:J,onPageChange:q,totalItems:p.length,itemsPerPage:g}),e.jsx(se,{isOpen:f.isOpen,title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir o template "${(R=f.template)==null?void 0:R.name}"? Esta ação não pode ser desfeita.`,confirmText:"Excluir",cancelText:"Cancelar",type:"danger",onConfirm:Q,onCancel:()=>y({isOpen:!1,template:null})}),L&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:()=>{h(!1),j()},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"800px",maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{style:{marginBottom:"1.5rem",fontSize:"1.5rem",fontWeight:"bold"},children:x?"Editar Template":"Novo Template"}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Nome *"}),e.jsx("input",{type:"text",value:s.name,onChange:t=>d({...s,name:t.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Categoria"}),e.jsx("input",{type:"text",value:s.category,onChange:t=>d({...s,category:t.target.value}),placeholder:"Ex: Revisão, Troca de Óleo...",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Descrição"}),e.jsx("textarea",{value:s.description,onChange:t=>d({...s,description:t.target.value}),rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",resize:"vertical"}})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:[e.jsx("input",{type:"checkbox",checked:s.active,onChange:t=>d({...s,active:t.target.checked})}),"Template ativo"]})}),e.jsxs("div",{style:{marginBottom:"2rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"1rem"},children:"Adicionar Item ao Template"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"150px 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Tipo"}),e.jsxs("select",{value:r.item_type,onChange:t=>Y(t.target.value),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"product",children:"Produto"}),e.jsx("option",{value:"labor",children:"Serviço"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:r.item_type==="product"?"Produto":"Serviço"}),e.jsxs("select",{value:r.item_type==="product"?r.product_id:r.labor_id,onChange:t=>{r.item_type==="product"?G(t.target.value):H(t.target.value)},style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"},children:[e.jsx("option",{value:"",children:"Selecione..."}),r.item_type==="product"?_.map(t=>e.jsxs("option",{value:t.id,children:[t.code||""," ",t.name," - ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.sale_price)]},t.id)):w.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)]},t.id))]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Descrição *"}),e.jsx("input",{type:"text",value:r.description,onChange:t=>a({...r,description:t.target.value}),required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:r.quantity,onChange:t=>a({...r,quantity:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:"Preço Unitário"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.unit_price,onChange:t=>a({...r,unit_price:t.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]})]}),e.jsxs("button",{type:"button",onClick:$,style:{padding:"0.75rem 1.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(B,{size:16}),"Adicionar Item"]})]}),c.length>0&&e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsxs("h3",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"1rem"},children:["Itens do Template (",c.length,")"]}),e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"8px",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Tipo"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Descrição"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Qtd"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Preço Unit."}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Total"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Ações"})]})}),e.jsx("tbody",{children:c.map((t,o)=>e.jsxs("tr",{style:{borderTop:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.item_type==="product"?e.jsx(te,{size:16,color:"#64748b"}):e.jsx(re,{size:16,color:"#64748b"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:t.item_type==="product"?"Produto":"Serviço"})]})}),e.jsx("td",{style:{padding:"0.75rem",fontSize:"0.875rem",color:"#1e293b"},children:t.description}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",color:"#64748b"},children:t.quantity}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",color:"#64748b"},children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.unit_price)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontSize:"0.875rem",fontWeight:"600",color:"#1e293b"},children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.quantity*t.unit_price)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:e.jsx("button",{type:"button",onClick:()=>U(o),style:{padding:"0.5rem",backgroundColor:"#fee2e2",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Remover",children:e.jsx(oe,{size:16,color:"#ef4444"})})})]},o))})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),j()},style:{padding:"0.75rem 1.5rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:x?"Atualizar":"Criar"})]})]})]})})]})};export{ge as default};
