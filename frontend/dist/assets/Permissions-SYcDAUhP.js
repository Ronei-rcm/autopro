import{u as Q,a as v,j as e}from"./index-DNHKrThd.js";import{r as a}from"./react-vendor-BpgKpUzx.js";import{z as u,S as Z,b as ee,f as re,ac as te,N as se,g as N,a9 as ie,H as q,ad as J,w as oe,X as ae}from"./ui-vendor-yLLZ9URH.js";import{S as k}from"./SkeletonLoader-DMsGFzU7.js";import"./pdf-vendor-BOaogWDS.js";const w={dashboard:"Dashboard",clients:"Clientes",vehicles:"Veículos",suppliers:"Fornecedores",inventory:"Estoque",quotes:"Orçamentos",orders:"Ordens de Serviço",appointments:"Agenda",financial:"Financeiro",reports:"Relatórios",settings:"Configurações",users:"Usuários",warranties:"Garantias",templates:"Templates",workshop_info:"Informações da Oficina",permissions:"Permissões"},V={view:"Visualizar",create:"Criar",edit:"Editar",delete:"Excluir",start:"Iniciar",finish:"Finalizar",cancel:"Cancelar",print:"Imprimir",approve:"Aprovar",convert:"Converter",movement:"Movimentar",payment:"Pagamento",export:"Exportar",payables_view:"Ver Contas a Pagar",payables_create:"Criar Contas a Pagar",payables_edit:"Editar Contas a Pagar",payables_delete:"Excluir Contas a Pagar",receivables_view:"Ver Contas a Receber",receivables_create:"Criar Contas a Receber",receivables_edit:"Editar Contas a Receber",receivables_delete:"Excluir Contas a Receber",manage_permissions:"Gerenciar Permissões"},ne={mechanic:{"dashboard:view":!0,"clients:view":!0,"clients:create":!0,"clients:edit":!0,"vehicles:view":!0,"vehicles:create":!0,"vehicles:edit":!0,"inventory:view":!0,"quotes:view":!0,"quotes:create":!0,"quotes:edit":!0,"orders:view":!0,"orders:create":!0,"orders:edit":!0,"orders:start":!0,"orders:finish":!0,"orders:print":!0,"appointments:view":!0,"appointments:create":!0,"appointments:edit":!0,"warranties:view":!0,"warranties:create":!0,"warranties:edit":!0,"templates:view":!0,"workshop_info:view":!0},financial:{"dashboard:view":!0,"clients:view":!0,"vehicles:view":!0,"inventory:view":!0,"quotes:view":!0,"orders:view":!0,"orders:print":!0,"financial:view":!0,"financial:payables_view":!0,"financial:payables_create":!0,"financial:payables_edit":!0,"financial:payables_delete":!0,"financial:receivables_view":!0,"financial:receivables_create":!0,"financial:receivables_edit":!0,"financial:receivables_delete":!0,"financial:payment":!0,"reports:view":!0,"reports:export":!0,"workshop_info:view":!0},attendant:{"dashboard:view":!0,"clients:view":!0,"clients:create":!0,"clients:edit":!0,"vehicles:view":!0,"vehicles:create":!0,"vehicles:edit":!0,"inventory:view":!0,"quotes:view":!0,"quotes:create":!0,"quotes:edit":!0,"orders:view":!0,"orders:create":!0,"orders:edit":!0,"orders:print":!0,"appointments:view":!0,"appointments:create":!0,"appointments:edit":!0,"appointments:delete":!0,"workshop_info:view":!0}},me=()=>{const{user:j}=Q(),[l,$]=a.useState("attendant"),[d,h]=a.useState([]),[S,z]=a.useState([]),[H,M]=a.useState(!0),[p,R]=a.useState(!1),[_,C]=a.useState(!1),[b,E]=a.useState(""),[y,O]=a.useState("all"),[g,F]=a.useState(!1),[m,D]=a.useState(!1),[f,P]=a.useState([]),[G,T]=a.useState(!1),x=(j==null?void 0:j.profile)==="admin";a.useEffect(()=>{x&&I()},[l,x,g]),a.useEffect(()=>{x&&m&&U()},[x,m]),a.useEffect(()=>{const r=JSON.stringify(d)!==JSON.stringify(S);C(r)},[d,S]);const I=async()=>{var r,s;try{M(!0);const t=g?"true":"false",o=await v.get(`/permissions/profile/${l}`,{params:{includeHidden:t}});h(o.data),z(JSON.parse(JSON.stringify(o.data)))}catch(t){u.error(((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao carregar permissões"),console.error(t)}finally{M(!1)}},U=async()=>{var r,s;try{T(!0);const t=await v.get("/module-settings");P(t.data.map(o=>({module:o.module,hidden:o.hidden})))}catch(t){u.error(((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao carregar configurações de módulos"),console.error(t)}finally{T(!1)}},X=async(r,s)=>{var t,o;try{await v.put(`/module-settings/${r}/visibility`,{hidden:s}),P(n=>n.find(c=>c.module===r)?n.map(c=>c.module===r?{...c,hidden:s}:c):[...n,{module:r,hidden:s}]),await I(),u.success(`Módulo ${s?"ocultado":"exibido"} com sucesso!`)}catch(n){u.error(((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.error)||"Erro ao atualizar visibilidade do módulo"),console.error(n)}},Y=r=>{h(s=>s.map(t=>t.id===r?{...t,granted:!t.granted}:t))},A=async()=>{var r,s;try{R(!0);const t=d.map(o=>({permission_id:o.id,granted:o.granted}));await v.put(`/permissions/profile/${l}`,{permissions:t}),u.success("Permissões atualizadas com sucesso!"),z(JSON.parse(JSON.stringify(d))),C(!1)}catch(t){u.error(((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao salvar permissões"),console.error(t)}finally{R(!1)}},W=()=>{h(JSON.parse(JSON.stringify(S))),C(!1)},K=()=>{if(l==="admin"){u.error("Não é possível aplicar template ao perfil Administrador");return}const r=ne[l];if(!r){u.error("Template não encontrado para este perfil");return}const s=d.map(t=>{const o=`${t.module}:${t.action}`;return{...t,granted:r[o]||!1}});h(s),u.success("Template aplicado com sucesso!")},L=a.useMemo(()=>{let r=d;if(!g&&f.length>0){const s=f.filter(t=>t.hidden).map(t=>t.module);r=r.filter(t=>!s.includes(t.module))}if(y!=="all"&&(r=r.filter(s=>s.module===y)),b){const s=b.toLowerCase();r=r.filter(t=>{const o=w[t.module]||t.module,n=V[t.action]||t.action,i=t.description||"";return o.toLowerCase().includes(s)||n.toLowerCase().includes(s)||i.toLowerCase().includes(s)||t.module.toLowerCase().includes(s)||t.action.toLowerCase().includes(s)})}return r.reduce((s,t)=>(s[t.module]||(s[t.module]=[]),s[t.module].push(t),s),{})},[d,y,b,g,f]),B=a.useMemo(()=>Array.from(new Set(d.map(s=>s.module))).sort(),[d]);return x?H?e.jsxs("div",{children:[e.jsx(k,{type:"text",lines:2,width:"40%",height:"32px"}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsx(k,{type:"card"})})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h1",{style:{fontSize:"1.875rem",fontWeight:"bold",color:"#1e293b",marginBottom:"0.5rem"},children:"Permissões"}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Gerencie as permissões de acesso por perfil"})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600",color:"#1e293b"},children:"Selecionar Perfil"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-start"},children:[e.jsxs("select",{value:l,onChange:r=>{$(r.target.value),E(""),O("all")},style:{width:"300px",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",backgroundColor:"white"},children:[e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"mechanic",children:"Mecânico"}),e.jsx("option",{value:"financial",children:"Financeiro"}),e.jsx("option",{value:"attendant",children:"Atendente"})]}),l!=="admin"&&e.jsxs("button",{onClick:K,style:{padding:"0.75rem 1.5rem",backgroundColor:"#3b82f6",border:"none",borderRadius:"8px",color:"white",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ee,{size:18}),"Aplicar Template"]})]}),l==="admin"&&e.jsx("p",{style:{fontSize:"0.875rem",color:"#f59e0b",marginTop:"0.5rem"},children:"⚠️ O perfil Administrador tem todas as permissões por padrão"})]}),e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",gap:"1rem",alignItems:"center"},children:[e.jsxs("button",{onClick:()=>D(!m),style:{padding:"0.5rem 1rem",backgroundColor:m?"#f97316":"white",border:"1px solid #e2e8f0",borderRadius:"8px",color:m?"white":"#64748b",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsx(re,{size:18}),m?"Ocultar Configurações":"Gerenciar Visibilidade de Módulos"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",fontSize:"0.875rem",color:"#64748b"},children:[e.jsx("input",{type:"checkbox",checked:g,onChange:r=>F(r.target.checked),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Mostrar módulos ocultos"]})]}),m&&e.jsxs("div",{style:{marginBottom:"2rem",padding:"1.5rem",backgroundColor:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1e293b",marginBottom:"1rem"},children:"Configuração de Visibilidade de Módulos"}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1.5rem"},children:"Clique no ícone de olho para ocultar ou exibir módulos. Módulos ocultos não aparecerão nas permissões por padrão."}),G?e.jsx(k,{type:"text",lines:3}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"1rem"},children:B.map(r=>{const s=f.find(o=>o.module===r),t=(s==null?void 0:s.hidden)||!1;return e.jsxs("div",{style:{padding:"1rem",backgroundColor:"white",borderRadius:"8px",border:`1px solid ${t?"#fecaca":"#e2e8f0"}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontWeight:"500",color:"#1e293b",fontSize:"0.875rem"},children:w[r]||r}),e.jsx("button",{onClick:()=>X(r,!t),style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:t?"#ef4444":"#10b981",display:"flex",alignItems:"center"},title:t?"Exibir módulo":"Ocultar módulo",children:t?e.jsx(te,{size:20}):e.jsx(se,{size:20})})]},r)})})]}),e.jsxs("div",{style:{marginBottom:"2rem",display:"flex",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,minWidth:"300px",position:"relative"},children:[e.jsx(N,{size:20,style:{position:"absolute",left:"0.75rem",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{type:"text",placeholder:"Buscar por módulo, ação ou descrição...",value:b,onChange:r=>E(r.target.value),style:{width:"100%",padding:"0.75rem 0.75rem 0.75rem 2.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}})]}),e.jsxs("div",{style:{minWidth:"200px"},children:[e.jsx(ie,{size:20,style:{marginRight:"0.5rem",color:"#94a3b8",display:"inline-block",verticalAlign:"middle"}}),e.jsxs("select",{value:y,onChange:r=>O(r.target.value),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",backgroundColor:"white"},children:[e.jsx("option",{value:"all",children:"Todos os Módulos"}),B.map(r=>e.jsx("option",{value:r,children:w[r]||r},r))]})]})]}),_&&e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{color:"#92400e",fontWeight:"500"},children:"Você tem alterações não salvas"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{onClick:W,style:{padding:"0.5rem 1rem",backgroundColor:"white",border:"1px solid #fbbf24",borderRadius:"6px",cursor:"pointer",color:"#92400e",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(q,{size:16}),"Desfazer"]}),e.jsxs("button",{onClick:A,disabled:p,style:{padding:"0.5rem 1rem",backgroundColor:"#f97316",border:"none",borderRadius:"6px",cursor:p?"not-allowed":"pointer",color:"white",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",opacity:p?.6:1},children:[e.jsx(J,{size:16}),p?"Salvando...":"Salvar"]})]})]}),Object.keys(L).length===0?e.jsxs("div",{style:{padding:"3rem",textAlign:"center",backgroundColor:"white",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[e.jsx(N,{size:48,color:"#94a3b8",style:{margin:"0 auto 1rem"}}),e.jsx("p",{style:{color:"#64748b",fontSize:"1rem"},children:"Nenhuma permissão encontrada com os filtros selecionados"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:Object.entries(L).map(([r,s])=>{var t,o,n;return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",overflow:"hidden",opacity:(t=f.find(i=>i.module===r))!=null&&t.hidden?.6:1},children:[e.jsx("div",{style:{padding:"1rem 1.5rem",backgroundColor:(o=f.find(i=>i.module===r))!=null&&o.hidden?"#fef2f2":"#f8fafc",borderBottom:"1px solid #e2e8f0",fontWeight:"600",color:"#1e293b",fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("span",{children:[w[r]||r,((n=f.find(i=>i.module===r))==null?void 0:n.hidden)&&e.jsx("span",{style:{marginLeft:"0.5rem",fontSize:"0.75rem",color:"#ef4444",fontWeight:"normal"},children:"(Oculto)"})]})}),e.jsx("div",{style:{padding:"1rem 1.5rem"},children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"1rem"},children:s.map(i=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",borderRadius:"6px",cursor:"pointer",backgroundColor:i.granted?"#f0fdf4":"#fef2f2",border:`1px solid ${i.granted?"#86efac":"#fecaca"}`,transition:"all 0.2s"},onMouseEnter:c=>{c.currentTarget.style.backgroundColor=i.granted?"#dcfce7":"#fee2e2"},onMouseLeave:c=>{c.currentTarget.style.backgroundColor=i.granted?"#f0fdf4":"#fef2f2"},children:[e.jsx("div",{style:{position:"relative",flexShrink:0},children:e.jsx("input",{type:"checkbox",checked:i.granted,onChange:()=>Y(i.id),style:{width:"20px",height:"20px",cursor:"pointer",accentColor:"#10b981"},disabled:l==="admin"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"500",color:"#1e293b",fontSize:"0.875rem"},children:V[i.action]||i.action}),i.description&&e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:i.description})]}),i.granted?e.jsx(oe,{size:18,color:"#10b981",style:{flexShrink:0}}):e.jsx(ae,{size:18,color:"#ef4444",style:{flexShrink:0}})]},i.id))})})]},r)})}),_&&e.jsxs("div",{style:{position:"fixed",bottom:"2rem",right:"2rem",display:"flex",gap:"0.75rem",zIndex:100},children:[e.jsxs("button",{onClick:W,style:{padding:"0.75rem 1.5rem",backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer",color:"#64748b",fontWeight:"500",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(q,{size:18}),"Desfazer"]}),e.jsxs("button",{onClick:A,disabled:p,style:{padding:"0.75rem 1.5rem",backgroundColor:"#f97316",border:"none",borderRadius:"8px",cursor:p?"not-allowed":"pointer",color:"white",fontWeight:"600",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)",display:"flex",alignItems:"center",gap:"0.5rem",opacity:p?.6:1},children:[e.jsx(J,{size:18}),p?"Salvando...":"Salvar Alterações"]})]})]}):e.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Z,{size:48,color:"#ef4444",style:{margin:"0 auto 1rem"}}),e.jsx("h2",{children:"Acesso Restrito"}),e.jsx("p",{children:"Apenas administradores podem gerenciar permissões."})]})};export{me as default};
