import{a as c,j as e}from"./index-DNHKrThd.js";import{r as a}from"./react-vendor-BpgKpUzx.js";import{z as x,S as E,g as R,X as L,a9 as I,a as T,q as D,a4 as j,u as y}from"./ui-vendor-yLLZ9URH.js";import{S as O}from"./SkeletonLoader-DMsGFzU7.js";import"./pdf-vendor-BOaogWDS.js";const N=()=>{const[v,S]=a.useState([]),[z,m]=a.useState(!0),[d,p]=a.useState(""),[n,C]=a.useState("all"),[l,W]=a.useState(null);a.useEffect(()=>{h(),g()},[n]);const h=async()=>{try{m(!0);const t={};n!=="all"&&(t.status=n);const r=await c.get("/warranties",{params:t});S(r.data)}catch(t){x.error("Erro ao carregar garantias"),console.error(t)}finally{m(!1)}},g=async()=>{try{const t=await c.get("/warranties/summary");W(t.data)}catch{console.error("Erro ao carregar resumo de garantias")}},w=t=>new Date(t).toLocaleDateString("pt-BR"),u=t=>({active:"#10b981",expired:"#ef4444",used:"#64748b",cancelled:"#94a3b8"})[t]||"#64748b",_=t=>({active:"Ativa",expired:"Expirada",used:"Utilizada",cancelled:"Cancelada"})[t]||t,A=t=>{switch(t){case"active":return e.jsx(y,{size:16,color:"#10b981"});case"expired":return e.jsx(j,{size:16,color:"#ef4444"});case"used":return e.jsx(y,{size:16,color:"#64748b"});case"cancelled":return e.jsx(j,{size:16,color:"#94a3b8"});default:return e.jsx(D,{size:16,color:"#64748b"})}},k=(t,r=30)=>{const o=new Date(t),s=new Date,i=o.getTime()-s.getTime(),b=Math.ceil(i/(1e3*60*60*24));return b>=0&&b<=r},f=v.filter(t=>{var o,s,i;const r=d.toLowerCase();return t.description.toLowerCase().includes(r)||((o=t.order_number)==null?void 0:o.toLowerCase().includes(r))||((s=t.client_name)==null?void 0:s.toLowerCase().includes(r))||((i=t.item_description)==null?void 0:i.toLowerCase().includes(r))}),B=async(t,r)=>{var o,s;try{await c.put(`/warranties/${t}`,{status:r}),x.success("Status da garantia atualizado!"),h(),g()}catch(i){x.error(((s=(o=i.response)==null?void 0:o.data)==null?void 0:s.error)||"Erro ao atualizar status")}};return e.jsxs("div",{style:{padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsxs("h1",{style:{fontSize:"2rem",fontWeight:"bold",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(E,{size:32,color:"#3b82f6"}),"Garantias"]}),e.jsx("p",{style:{color:"#64748b"},children:"Gerencie as garantias dos serviços realizados"})]}),l&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem"},children:"Total de Garantias"}),e.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#1e293b"},children:l.total||0})]}),e.jsxs("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem"},children:"Ativas"}),e.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#10b981"},children:l.active_count||0})]}),e.jsxs("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem"},children:"Expiradas"}),e.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#ef4444"},children:l.expired_count||0})]}),e.jsxs("div",{style:{padding:"1.5rem",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem"},children:"Expirando em 30 dias"}),e.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#f59e0b"},children:l.expiring_soon_count||0})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"300px"},children:[e.jsx(R,{size:20,style:{position:"absolute",left:"0.75rem",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{type:"text",placeholder:"Buscar por descrição, OS, cliente...",value:d,onChange:t=>p(t.target.value),style:{width:"100%",padding:"0.75rem 0.75rem 0.75rem 2.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem"}}),d&&e.jsx("button",{onClick:()=>p(""),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(L,{size:16,color:"#94a3b8"})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(I,{size:20,color:"#64748b"}),e.jsxs("select",{value:n,onChange:t=>C(t.target.value),style:{padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.9rem",cursor:"pointer"},children:[e.jsx("option",{value:"all",children:"Todos os status"}),e.jsx("option",{value:"active",children:"Ativas"}),e.jsx("option",{value:"expired",children:"Expiradas"}),e.jsx("option",{value:"used",children:"Utilizadas"}),e.jsx("option",{value:"cancelled",children:"Canceladas"})]})]})]}),e.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)",overflow:"hidden"},children:z?e.jsx(O,{type:"table"}):f.length===0?e.jsx("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:d||n!=="all"?"Nenhuma garantia encontrada com os filtros aplicados":"Nenhuma garantia cadastrada"}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"OS"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Cliente"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Item"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Descrição"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Período"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Vencimento"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Status"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#64748b"},children:"Ações"})]})}),e.jsx("tbody",{children:f.map(t=>{const r=t.status==="active"&&k(t.end_date);return e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",backgroundColor:r?"#fffbeb":"white"},children:[e.jsx("td",{style:{padding:"1rem"},children:e.jsx("div",{style:{fontWeight:"600"},children:t.order_number||`OS #${t.order_id}`})}),e.jsx("td",{style:{padding:"1rem",color:"#64748b"},children:t.client_name||"-"}),e.jsx("td",{style:{padding:"1rem",color:"#64748b",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.item_description||"-"}),e.jsx("td",{style:{padding:"1rem",fontWeight:"500"},children:t.description}),e.jsxs("td",{style:{padding:"1rem",color:"#64748b"},children:[t.warranty_period_days," dia",t.warranty_period_days!==1?"s":""]}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(T,{size:16,color:r?"#f59e0b":"#64748b"}),e.jsx("span",{style:{color:r?"#f59e0b":"#1e293b",fontWeight:r?"600":"400"},children:w(t.end_date)}),r&&e.jsx("span",{style:{fontSize:"0.75rem",color:"#f59e0b",fontWeight:"600"},children:"(Expira em breve)"})]})}),e.jsx("td",{style:{padding:"1rem",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[A(t.status),e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:u(t.status)+"20",color:u(t.status)},children:_(t.status)})]})}),e.jsx("td",{style:{padding:"1rem"},children:t.status==="active"&&e.jsxs("select",{value:t.status,onChange:o=>B(t.id,o.target.value),style:{padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",cursor:"pointer",backgroundColor:"white"},children:[e.jsx("option",{value:"active",children:"Ativa"}),e.jsx("option",{value:"used",children:"Marcar como Utilizada"}),e.jsx("option",{value:"cancelled",children:"Cancelar"})]})})]},t.id)})})]})})})]})};export{N as default};
